upstream angular {
    server      angular;
}

upstream backend {
    server      varnish:8080;
}

server {
    listen  80;
    server_name _;

    return  301 https://$host$request_uri;
}

# Front-end
server {
    listen  443 ssl;
    server_name haridusportaal.twn.zone;

    include /etc/nginx/common.conf;
    include /etc/nginx/ssl.conf;

    location / {
        proxy_pass  http://angular;
        include common_location.conf;
    }
}

# Backend
server {
    listen  443 ssl;
    server_name api.haridusportaal.twn.zone;

    include /etc/nginx/common.conf;
    include /etc/nginx/ssl.conf;

    location / {
        proxy_pass  http://backend;
        include common_location.conf;
    }
}