<div class="dialog" cdkTrapFocus tabindex="0" role="dialog" attr.aria-label="{{'Modal open'}}">
  <div class="row">
    <div class="col-12" style="position: relative;">
      <span class="dialog__text--medium" tabindex="0">{{ 'event.registration_form' | translate | uppercase }}</span>
      <div attr.aria-label="{{'Click to close modal'}}" role="close">
      <mat-icon mat-icon-button>close
        <button class="btn-hidden" (click)="close()" tabindex="0"></button>
      </mat-icon>
  </div>
    </div>

    
    <div class="col-12" *ngIf="step === 0 && !loader">
      <h1 tabindex="0">{{ data.eventTitle }}</h1>
      <div class="dialog__time" tabindex="0"> 
        <span class="capitalize">{{ 'time.'+ (data.eventStartDate.fieldEventDate.unix*1000 | weekday: "unix" | lowercase) | translate }} {{ data.eventStartDate.fieldEventDate.unix*1000 | date: "dd.MM"}}</span>
        <span>{{ 'time.time_of_day' | translate }}</span>
        <span>{{ data.eventStartDate.fieldEventStartTime | unixToTime }} - {{ data.eventStartDate.fieldEventEndTime | unixToTime }}</span>
      </div>
      <div class="dialog__required">* {{ 'event.registration_form_required' | translate }}</div>
    </div><!--/col-12-->
    <form [formGroup]="form" class="dialog__form col-12" *ngIf="step === 0 && !loader">

      <div class="dialog-content">
        <div class="row">
          <div class="col-6 sm-12">
            <div class="round-input__wrapper" [class.complete]="form.controls.firstName.value">
              <span class="round-input__title">{{ 'event.participant_first_name' | translate }} *</span>
              <div class="round-input__field-wrapper">
                <input maxlength="30" class="round-input__field" placeholder="{{ 'event.participant_first_name' | translate }} *" formControlName="firstName"/>
              </div>
              <div class="round-input__error">
                <div class="round-input__error--text" *ngIf="isInvalidField('firstName') && form.controls.firstName.errors.required">
                  {{ 'event.registration_form_required' | translate }}
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-6 sm-12">
            <div class="round-input__wrapper" [class.complete]="form.controls.lastName.value">
              <span class="round-input__title">{{ 'event.participant_last_name' | translate }} *</span>
              <div class="round-input__field-wrapper">
                <input maxlength="30" class="round-input__field" placeholder="{{ 'event.participant_last_name' | translate }} *" formControlName="lastName"/>
              </div>
              <div class="round-input__error">
                <div class="round-input__error--text" *ngIf="isInvalidField('lastName') && form.controls.lastName.errors.required">
                  {{ 'event.registration_form_required' | translate }}
                </div>
              </div>
            </div>
          </div>
        
          <div class="col-12 sm-12">
            <div class="round-input__wrapper" [class.complete]="form.controls.companyName.value">
              <span class="round-input__title">{{ 'event.participant_organization' | translate }}</span>
              <div class="round-input__field-wrapper">
                <input maxlength="60" class="round-input__field" placeholder="{{ 'event.participant_organization' | translate }}" formControlName="companyName"/>
              </div>
              <div class="round-input__error">
                <div class="round-input__error--text"></div>
              </div>
            </div>
          </div>
        
          <div class="col-6 sm-12">
            <div class="round-input__wrapper" 
              [class.error]="isInvalidField('email') && form.controls.email.errors.email && !emailFocus" 
              [class.success]="!isInvalidField('email') && form.controls.email.value && !emailFocus">
              <span class="round-input__title">{{ 'event.participant_email' | translate }} *</span>
              <div class="round-input__field-wrapper">
                <input maxlength="30" class="round-input__field" (focus)="emailFocus = true" (blur)="emailFocus = false" [class.focused]='emailFocus' placeholder="{{ 'event.participant_email'  | translate }} *" formControlName="email"/>
              </div>
              <div class="round-input__error">
                <div class="round-input__error--text" *ngIf="isInvalidField('email') && form.controls.email.errors.email && !emailFocus">
                  {{ 'event.registration_form_valid_email' | translate }}
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-6 sm-12">
            <div class="round-input__wrapper" [class.complete]="form.controls.telephone.value">
              <span class="round-input__title">{{ 'event.participant_phone' | translate }}</span>
              <div class="round-input__field-wrapper">
                <input maxlength="30" class="round-input__field" placeholder="{{ 'event.participant_phone' | translate }}" formControlName="telephone"/>
              </div>
              <div class="round-input__error">
                <div class="round-input__error--text"></div>
              </div>
            </div>
          </div>

          <!-- <div class="col-12 sm-12">
            <div class="round-input__wrapper">
              <span class="round-input__title">{{ 'participantComment' | translate }}</span>
              <div class="round-input__field-wrapper">
                <input class="round-input__field" placeholder="{{ 'participantComment' | translate }}" formControlName="marked"/>
              </div>
              <div class="round-input__error">
                <div class="round-input__error--text"></div>
              </div>
            </div>
          </div> -->
          
          <div class="col-12 sm-12">
            <div class="round-input__area">
              <textarea class="round-input__area__elem" autosize placeholder="{{ 'event.participant_comment' | translate }}" formControlName="marked"></textarea>
            </div>
          </div>

        </div>
      </div>

      <div class="dialog__actions row" *ngIf="step === 0 && !loader">
        <div class="col-12 text-right">

          <re-captcha #captchaRef="reCaptcha" size="invisible" siteKey="6LfDw2kUAAAAAOi8gknhV8quV2J_FdjsT36GSf90" (resolved)="$event && save($event)"></re-captcha>
            
          <a class="sm-hide" href="javascript:void(0)" (click)="clear()">{{ 'event.registration_form_cancel' | translate }}</a>
          <button [disabled]="form.status === 'INVALID'" mat-raised-button color="primary" (click)="captchaRef.execute()">{{ 'event.registration_form_send' | translate }}</button>
          <a class="sm-show" href="javascript:void(0)" (click)="clear()">{{ 'event.registration_form_cancel' | translate }}</a>
          <!-- [disabled]="form.invalid" -->
        </div>
      </div>
    </form>

    <div class="col-12" *ngIf="loader">
      <mat-spinner></mat-spinner>
    </div><!--/col-12-->
    
    <div class="dialog__success" *ngIf="step === 1">
      <div class="dialog__success__title">
        <h1>{{ 'event.registration_form_thanks' | translate }}</h1>
      </div>
      <div class="dialog__actions--success">
        <div class="row text-center">
          <div class="col-12">
            <button mat-raised-button color="primary" (click)="close()">{{ 'event.registration_form_add_to_calendar' | translate }}</button>
          </div>
          <div class="dialog__actions--success__close col-12"><a href="javascript:void(0)" (click)="close()">{{ 'event.registration_form_close' | translate }}</a></div>
        </div>
      </div>
    </div>
  </div>
</div>
