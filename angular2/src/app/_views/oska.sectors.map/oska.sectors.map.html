<div><breadcrumbs></breadcrumbs></div>
<form (submit)="filterSubmit($event)" class="filter-wrapper">
  <div class="main-container">
    <div class="row">
      <div class="col-4 sm-12">
        <div class="round-input__wrapper" [class.complete]="filterFormItems.mapIndicator">
          <mat-form-field>
            <mat-select (openedChange)="setRelatedFilter('mapIndicator', 'OSKAField')" placeholder="{{ 'oskaProfessions.indicator' | translate }}" [(ngModel)]="filterFormItems.mapIndicator" name="mapIndicator">
              <ng-container  *ngIf="filterData && filterData.mapIndicator">
                <ng-container *ngFor="let item of filterData.mapIndicator">
                  <mat-option [value]="item">
                    {{ item }}
                  </mat-option>
                </ng-container>
              </ng-container>
            </mat-select>
          </mat-form-field>
        </div><!--/round-inpuit__wrapper-->
      </div><!--/col-4-->
      <div class="col-6 sm-12">
        <div class="round-input__wrapper" [class.complete]="filterFormItems.OSKAField" [class.disabled]="filterData.OSKAField && !filterData.OSKAField.length">
          <mat-form-field>
            <mat-select [disabled]="filterData.OSKAField && !filterData.OSKAField.length" 
              (openedChange)="setRelatedFilter('mapIndicator', 'OSKAField')"
              [placeholder]="fieldPlaceholder()" 
              [(ngModel)]="filterFormItems.OSKAField"
              name="OSKAField">
              <ng-container  *ngIf="filterData && filterData.OSKAField">
                <ng-container *ngFor="let item of filterData.OSKAField">
                  <mat-option [value]="item">
                    {{ item }}
                  </mat-option>
                </ng-container>
              </ng-container>
            </mat-select>
          </mat-form-field>
        </div><!--/round-inpuit__wrapper-->
      </div><!--/col-4-->
      <div class="col-2 sm-12 align-end flex-end">
        <div class="button-row">
          <button role="button" mat-raised-button color="primary">{{ 'button.filter' | translate }}</button>
        </div>
      </div><!--/col-4-->
    </div><!--/row-->
  </div>
</form>

<div class="sectors main-container">

  <div class="sectors__list-head">
    <div class="sectors__head">
      <h1 class="sectors__title text-left" aria-hidden="true">{{ 'oska.fields_data_on_map' | translate | uppercase }}</h1>
      <div class="button-list">
        <div class="view-item pointer" role="tab" (keyup.enter)="changeView('/valdkonnad')" (click)="changeView('/valdkonnad')" attr.aria-label="{{ 'oska.grid' | translate }} {{ 'oska.view' | translate}}" tabindex="0">
          <span aria-hidden="true" class="htm-icon">apps</span>
          <div aria-hidden="true" class="title" >{{ 'oskaProfessions.fields' | translate }}</div>
        </div>
        <div class="view-item pointer" role="tab" (keyup.enter)="changeView('/valdkonnad/andmed')" (click)="changeView('/valdkonnad/andmed')" attr.aria-label="{{ 'oskaProfessions.fieldsCompare' | translate }}" tabindex="0">
          <span aria-hidden="true" class="htm-icon">compare_arrows</span>
          <div aria-hidden="true" class="title">{{ 'oska.data' | translate }}</div>
        </div>
        <div class="view-item pointer active" id="heading" attr.aria-label="{{ 'oskaProfessions.map' | translate }}" tabindex="0">
          <span aria-hidden="true" class="htm-icon">location_on</span>
          <div aria-hidden="true" class="title">{{ 'oskaProfessions.map' | translate }}</div>
        </div>
      </div>  
    </div>
  </div>
  <div class="sectors__list-body" *ngIf="!polygonData">
    <loader></loader>
  </div>
  <div class="sectors__list-body" *ngIf="polygonData && polygonData.length">
    <h2>{{ 'oska.field_map_introduction' | translate }}</h2>
    <div class="map-wrapper" [class.polygonMap]="polygons">
      <div class="map-loader" *ngIf="loading" >
        <loader></loader>
      </div><!--/map-loader-->
      <agm-map (zoomChange)="zoomChange($event)" (mapReady)="mapReady($event)" [minZoom]="mapOptions.minZoom" [maxZoom]="mapOptions.maxZoom" style="height:525px" [styles]="mapOptions.styles">
  
        <agm-data-layer *ngIf="polygons" [geoJson]="polygons" [style]="polygonStyles" (layerClick)="kmlClick($event)">
        </agm-data-layer>
        
        <ng-container *ngIf="polygons && polygons.features && polygonLabels && polygonLabels.length">
          <ng-container *ngFor="let item of polygonLabels">
            <agm-marker *ngIf="item.labelOptions && item.labelOptions.text" [iconUrl]="icon" [latitude]="item.latitude" [longitude]="item.longitude" [label]="item.labelOptions"></agm-marker>
          </ng-container>
        </ng-container>
  
        <ng-container *ngIf="sumWindowStatus">
          <!-- <agm-snazzy-info-window [closeWhenOthersOpen]="true" #sumLayer isOpen="sumWindowStatus" [latitude]="sumWindowLat" [longitude]="sumWindowLon" (isOpenChange)="kmlClickStatus($event)" >
            <ng-template>
              <b>{{ infoLayer.name }}</b><br />
              <span *ngIf="infoLayer.field">{{ infoLayer.field }}<br /></span>
              <span *ngIf="infoLayer.value">{{ infoLayer.value }}</span>
            </ng-template>
          </agm-snazzy-info-window> -->
        </ng-container>
      </agm-map>
      <div class="map__additions">
        <div class="pair" *ngIf="params && params.mapIndicator">
          <div class="pair__label">{{ 'oskaProfessions.indicator' | translate }}:</div> 
          <div class="pair__value">{{ params.mapIndicator | ellipsis:20 }}</div>
        </div>
        <div class="pair" *ngIf="params && params.OSKAField">
          <div class="pair__label">{{ 'oska.title_field' | translate }}:</div> 
          <div class="pair__value">{{ params.OSKAField | ellipsis:20 }}</div>
        </div>
      </div>
    </div><!--/map-wrapper-->
  
    <ng-container *ngIf="heatMapRanges.length > 0">
      <div class="mapLegend">
        <ng-container *ngFor="let item of heatMapRanges">
          <div class="mapLegend__block" *ngIf="params && params.mapIndicator && fieldMaxRanges[params.mapIndicator] && item.amount <= fieldMaxRanges[params.mapIndicator]">
            <div class="mapLegend__color" [style.background-color]="item.color"></div>
          </div>
        </ng-container>
      </div>
      <div class="mapLegend__labels" *ngIf="indicatorLegendLabels[params.mapIndicator]">
        <div>{{ indicatorLegendLabels[params.mapIndicator].start }}</div>
        <div>{{ indicatorLegendLabels[params.mapIndicator].end }}</div>
      </div>
    </ng-container>
  
    <!-- <div class="map-created" *ngIf="polygons">{{ filterData }}</div> -->
  </div>

</div>
