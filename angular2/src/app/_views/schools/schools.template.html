<breadcrumbs></breadcrumbs>

<div class="sm-show text-right filter-control">
  <a href="javascript:void(0);" (click)="showFilter = !showFilter">
    <span *ngIf="!showFilter">{{ 'button.filter' |translate }}</span>
    <span *ngIf="showFilter">{{ 'button.filter_close' | translate }}</span>
  </a> 
</div>

<form (submit)="filterSubmit()" class="filter-wrapper" *ngIf="showFilter">
  <div class="main-container">
    <div class="row">
      <div class="col-4 sm-12">
        <div class="round-input__wrapper" [class.complete]="filterFormItems.title">
          <span class="round-input__title">{{ 'school.name' | translate }}</span>
          <div class="round-input__field-wrapper">
            <input class="round-input__field" placeholder="{{ 'school.name' | translate }} " [(ngModel)]='filterFormItems.title' name="title" />
          </div>
        </div><!--/round-inpuit__wrapper-->
      </div><!--/col-4-->
      <div class="col-5 sm-12">
        <div class="round-input__wrapper" [class.complete]="filterFormItems.location">
          <span class="round-input__title">{{ 'school.location' | translate }}</span>
          <div class="round-input__field-wrapper">
            <input class="round-input__field" placeholder="{{ 'school.location' | translate }} " [(ngModel)]='filterFormItems.location' name="location" />
          </div>
        </div><!--/round-inpuit__wrapper-->
      </div><!--/col-4-->
  
      <div class="col-3 align-end text-right sm-12 inline-flex sm-hide" *ngIf="!filterFull">
        <div class="align-center filter-state sm-hide">       
          <a href="javascript:void(0);"  (click)="filterFull = !filterFull">
            <span class="md-hide">{{ 'button.search_detailed' | translate }}</span>
            <span class="md-show">{{ 'button.filter' | translate }}</span>
          </a>
        </div>
        <div class="button-row">
          <button mat-raised-button color="primary">{{ 'button.search' | translate }}</button>
        </div>
      </div><!--/col-3-->
    </div><!--/row-->
  
    <div class="row" *ngIf="filterFull" style="margin-top:0.5rem;">
      <div class="col-4 sm-12">
        <div class="round-input__wrapper">
          <mat-form-field>
            <mat-select placeholder="{{ 'school.institution_type' | translate }}" [(ngModel)]="filterFormItems.type" name="type">
              <mat-option>{{ 'button.all' | translate }}</mat-option>
              <ng-container *ngFor="let item of typeOptions">
                <mat-option *ngIf="item.parentId == null" [value]="item.entityId">
                  {{ item.entityLabel }}
                </mat-option>
              </ng-container>
            </mat-select>
          </mat-form-field>
        </div><!--/round-input__wrapper-->
        
      </div>

      <div class="col-5 sm-12">
        <div class="round-input__wrapper" [class.disabled]="getSubTypes('type').length == 0">
          <mat-form-field>
            <mat-select [placeholder]="getSubTypes('type').length !== 0 ? 'Õppeasutuse alamtase' : 'Vali esmalt õppeasutuse tüüp'" [(ngModel)]="filterFormItems.subtype" name="subtype">
              <mat-option *ngIf="getSubTypes('type').length !== 0">{{ 'button.all' | translate }}</mat-option>
              <mat-option *ngFor="let item of getSubTypes('type')" [value]="item.entityId">
                {{ item.entityLabel }}
              </mat-option>

            </mat-select>
          </mat-form-field>
        </div><!--/round-input__wrapper-->
      </div><!--/col-5-->

      <div class="col-4 sm-12">
        <div class="round-input__wrapper">
          <mat-form-field>
            <mat-select placeholder="{{ 'school.language' | translate }}" [(ngModel)]="filterFormItems.language" name="language">
              <mat-option>{{ 'button.all' | translate }}</mat-option>
              <mat-option *ngFor="let item of languageOptions" [value]="item.entityId">
                {{ item.entityLabel }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div><!--/round-input__wrapper-->
      </div><!--/col-4-->

      <div class="col-5 sm-12">
        <div class="round-input__wrapper">
          <mat-form-field>
            <mat-select placeholder="{{ 'school.ownership' | translate }}" [(ngModel)]="filterFormItems.ownership" name="ownership">
              <mat-option>{{ 'button.all' | translate }}</mat-option>
              <mat-option *ngFor="let item of ownershipOptions" [value]="item.entityId">
                {{ item.entityLabel }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div><!--/round-input__wrapper-->
      </div><!--/col-5-->

      <div class="col-9">
        <div class="form-spacer-20"></div>
        <div class="custom-checkbox">
          <mat-checkbox [(ngModel)]="filterFormItems.specialClass" name="specialClass">{{ 'school.special_needs_short' | translate }}</mat-checkbox>
        </div><!--/custom-checkbox-->
        <div class="custom-checkbox">
          <mat-checkbox [(ngModel)]="filterFormItems.studentHome" name="studentHome">{{ 'school.dormitory' | translate}}</mat-checkbox>
        </div><!--/custom-checkbox-->
      </div><!--/col-9-->
      <div class="col-3 align-end text-right sm-12 inline-flex">
        <div class="align-center filter-state sm-hide">       
          <a href="javascript:void(0);" (click)="filterFull = !filterFull">
            <span class="md-hide">{{ 'button.search_brief' | translate }}</span>
          </a>
        </div>
        <div class="button-row">
          <button mat-raised-button color="primary">{{ 'button.search' | translate }}</button>
        </div>
      </div><!--/col-3-->
    </div><!--/row-->
  </div>
</form>

<div class="schools main-container">
  <div class="schools__list-head">
    <div class="schools__head">
      <div class="schools__title text-left">{{ 'school.label' | translate | uppercase }}</div>
      <div class="button-list text-right">
        <div class="view-item" (click)="changeView('list')" [class.active]="view === 'list'">
          <mat-icon>list</mat-icon>
          <div class="title">{{ 'school.list' | translate }}</div>
        </div>
        <div class="view-item" (click)="changeView('map')" [class.active]="view === 'map'">
          <mat-icon>location_on</mat-icon>
          <div class="title">{{ 'school.map' | translate }}</div>
        </div>
      </div><!--/button-list-->
    </div>
  </div><!--/schools__list-head-->

  
  <div class="spinner-wrapper" *ngIf="!list"><mat-spinner></mat-spinner></div>

  <div *ngIf="list && list.length == 0 && view == 'list'" class="no-results">
    {{ 'school.no_results' | translate }}
  </div>

  <div *ngIf="list && list.length > 0 && view == 'list'">
    <ng-container *ngFor="let item of list">
      <div class="schools__item">
          <a [routerLink]="item.EntityPath" class="schools__item__title">{{ item.FieldSchoolName }}</a>
          <div class="schools__item__col sm-hide">
              <p *ngIf="item.FieldAddress">{{ 'school.legal_address' | translate }}: <b>{{ item.FieldAddress }}</b></p>
              <p *ngIf="item.FieldSchoolWebpageAddress">{{ 'school.website' | translate }}: <a href="{{ item.FieldSchoolWebpageAddress | url }}" target="_blank">{{ item.FieldSchoolWebpageAddress | removeProtocol }}</a></p>
          </div><!--/scools__item__col-->
          <div class="schools__item__col sm-hide">
            <p *ngIf="item.FieldEducationalInstitutionTy">{{ 'school.institution_type' | translate }}: <b>{{ item.FieldEducationalInstitutionTy }}</b></p>
            <p *ngIf="item.FieldSchoolContactPhone || item.FieldSchoolContactEmail" >{{ 'school.contact_info' | translate }}: <b *ngIf="item.FieldSchoolContactPhone">{{ item.FieldSchoolContactPhone }}</b><span *ngIf="item.FieldSchoolContactPhone && item.FieldSchoolContactEmail">,</span> <a *ngIf="item.FieldSchoolContactEmail" href="mailto:{{ item.FieldSchoolContactEmail}}">{{ item.FieldSchoolContactEmail}}</a></p>
          </div><!--/scools__item__col-->
      </div><!--/schools__item-->
    </ng-container><!--/list repeat-->
  </div><!--/list-->

  <ng-container *ngIf="view == 'map'">
    <div class="map--wrapper">
      <agm-map (mapReady)="mapReady($event)" style="height:525px" *ngIf="list" maxZoom="16">
        <agm-marker-cluster [styles]="mapOptions.clusterStyles" maxZoom="15">
          <agm-marker [iconUrl]="mapOptions.icon" *ngFor="let marker of list" [latitude]="parseFloat(marker.Lat)"  [longitude]="parseFloat(marker.Lon)" >
            <agm-snazzy-info-window [closeWhenOthersOpen]="true">
              <ng-template>
                <p class="title">{{ marker.FieldSchoolName }}</p>
                <p *ngIf="marker.FieldAddress">{{ 'school.legal_address' | translate }}: <b>{{ marker.FieldAddress }}</b></p>
                
                <p *ngIf="marker.FieldEducationalInstitutionTy">{{ 'school.institution_type' | translate }}: <b>{{ marker.FieldEducationalInstitutionTy }}</b></p>
                <p *ngIf="marker.FieldSchoolContactPhone || marker.FieldSchoolContactEmail" >{{ 'school.contact_info' | translate }}: <b *ngIf="marker.FieldSchoolContactPhone">{{ marker.FieldSchoolContactPhone }}</b><span *ngIf="marker.FieldSchoolContactPhone && marker.FieldSchoolContactEmail">,</span> <a *ngIf="marker.FieldSchoolContactEmail" href="mailto:{{ marker.FieldSchoolContactEmail}}"><b>{{ marker.FieldSchoolContactEmail}}</b></a></p>

                <p *ngIf="marker.FieldSchoolWebpageAddress">{{ 'school.website' | translate }}: <a href="{{ marker.FieldSchoolWebpageAddress | url }}" target="_blank"><b>{{ marker.FieldSchoolWebpageAddress | removeProtocol }}</b></a></p>
                <a [routerLink]="marker.EntityPath" class="button">{{ 'button.view_more' | translate }}</a>
              </ng-template>
            </agm-snazzy-info-window>
          </agm-marker>
        </agm-marker-cluster>
      </agm-map>
    </div>
  </ng-container>

</div><!--/schools-->

<div class="text-center actions" *ngIf="!listEnd && view == 'list' && list">
  <mat-spinner *ngIf="loading" diameter="20" style="margin:0 auto;"></mat-spinner>
  <button mat-raised-button color="primary" (click)="loadMore()"  *ngIf="!loading">
    {{ "button.load_more" | translate }}
  </button>
</div><!--/text-center-->
