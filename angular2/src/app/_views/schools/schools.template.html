<breadcrumbs></breadcrumbs>

<div class="sm-show text-right filter-control">
  <a href="javascript:void(0);" (click)="showFilter = !showFilter">
    <span *ngIf="!showFilter">{{ 'filter' |translate }}</span>
    <span *ngIf="showFilter">{{ 'filter.close' | translate }}</span>
  </a> 
</div>

<form (submit)="filterSubmit()" class="filter-wrapper" *ngIf="showFilter">
  <div class="main-container">
    <div class="row">
      <div class="col-4 sm-12">
        <div class="round-input__wrapper" [class.complete]="filterFormItems.title">
          <span class="round-input__title">{{ 'school.name' | translate }}</span>
          <div class="round-input__field-wrapper">
            <input class="round-input__field" placeholder="{{ 'school.name' | translate }} " [(ngModel)]='filterFormItems.title' name="title" />
          </div>
        </div><!--/round-inpuit__wrapper-->
      </div><!--/col-4-->
      <div class="col-5 sm-12">
        <div class="round-input__wrapper" [class.complete]="filterFormItems.location">
          <span class="round-input__title">{{ 'location' | translate }}</span>
          <div class="round-input__field-wrapper">
            <input class="round-input__field" placeholder="{{ 'location' | translate }} " [(ngModel)]='filterFormItems.location' name="location" />
          </div>
        </div><!--/round-inpuit__wrapper-->
      </div><!--/col-4-->
  
      <div class="col-3 align-end text-right sm-12 inline-flex sm-hide" *ngIf="!filterFull">
        <div class="align-center filter-state sm-hide">       
          <a href="javascript:void(0);"  (click)="filterFull = !filterFull">
            <span class="md-hide">{{ 'search.detailed' | translate }}</span>
            <span class="md-show">{{ 'filter' | translate }}</span>
          </a>
        </div>
        <div class="button-row">
          <button mat-raised-button color="primary">{{ 'search' | translate }}</button>
        </div>
      </div><!--/col-3-->
    </div><!--/row-->
  
    <div class="row" *ngIf="filterFull" style="margin-top:0.5rem;">
      <div class="col-4 sm-12">
        <div class="round-input__wrapper">
          <mat-form-field>
            <mat-select placeholder="{{ 'school.institution.type' | translate }}" [(ngModel)]="filterFormItems.type" name="type">
              <mat-option>{{ 'all' | translate }}</mat-option>
              <mat-option *ngFor="let item of typeOptions" [value]="item.entityId">
                {{ item.entityLabel }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div><!--/round-input__wrapper-->
        
      </div>
      <div class="col-5 sm-hide"></div>

      <div class="col-4 sm-12">
        <div class="round-input__wrapper">
          <mat-form-field>
            <mat-select placeholder="{{ 'school.teachingLanguage' | translate }}" [(ngModel)]="filterFormItems.language" name="language">
              <mat-option>{{ 'all' | translate }}</mat-option>
              <mat-option *ngFor="let item of languageOptions" [value]="item.entityId">
                {{ item.entityLabel }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div><!--/round-input__wrapper-->
      </div><!--/col-4-->

      <div class="col-5 sm-12">
        <div class="round-input__wrapper">
          <mat-form-field>
            <mat-select placeholder="{{ 'school.ownership' | translate }}" [(ngModel)]="filterFormItems.ownership" name="ownership">
              <mat-option>{{ 'all' | translate }}</mat-option>
              <mat-option *ngFor="let item of ownershipOptions" [value]="item.entityId">
                {{ item.entityLabel }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div><!--/round-input__wrapper-->
      </div><!--/col-5-->

      <div class="col-9">
        <div class="form-spacer-20"></div>
        <div class="custom-checkbox">
          <mat-checkbox [(ngModel)]="filterFormItems.specialClass" name="specialClass">HEV</mat-checkbox>
        </div><!--/custom-checkbox-->
        <div class="custom-checkbox">
          <mat-checkbox [(ngModel)]="filterFormItems.studentHome" name="studentHome">Õpilaskodu/Ühiselamu olemas</mat-checkbox>
        </div><!--/custom-checkbox-->
      </div><!--/col-9-->
      <div class="col-3 align-end text-right sm-12 inline-flex">
        <div class="align-center filter-state sm-hide">       
          <a href="javascript:void(0);" (click)="filterFull = !filterFull">
            <span class="md-hide">{{ 'search.narrow' | translate }}</span>
            <span class="md-show">{{ 'filter.narrow' | translate }}</span>
          </a>
        </div>
        <div class="button-row">
          <button mat-raised-button color="primary">{{ 'search' | translate }}</button>
        </div>
      </div><!--/col-3-->
    </div><!--/row-->
  </div>
</form>

<div class="schools main-container">
  <div class="schools__list-head">
    <div class="schools__head">
      <div class="schools__title text-left">{{ 'schools' | translate | uppercase }}</div>
      <div class="button-list text-right">
        <div class="view-item" (click)="changeView('list')" [class.active]="view === 'list'">
          <mat-icon>list</mat-icon>
          <div class="title">{{ 'list' | translate }}</div>
        </div>
        <div class="view-item" (click)="changeView('map')" [class.active]="view === 'map'">
          <mat-icon>location_on</mat-icon>
          <div class="title">{{ 'map' | translate }}</div>
        </div>
      </div><!--/button-list-->
    </div>
  </div><!--/schools__list-head-->

  
  <div class="spinner-wrapper" *ngIf="!list"><mat-spinner></mat-spinner></div>

  <div *ngIf="list && list.length > 0 && view == 'list'">
    <ng-container *ngFor="let item of list">
      <div class="schools__item">
          <a [routerLink]="item.entityUrl.path" class="schools__item__title">{{ item.entityLabel }}</a>
          <div class="schools__item__col sm-hide">
              <p *ngIf="item.fieldSchoolLocation[0]">{{ 'legal_address' | translate }}: <b>{{ item.fieldSchoolLocation[0].entity.fieldAddress }}</b></p>
              <p *ngIf="item.fieldSchoolWebpageAddress">{{ 'website' | translate }}: <a href="{{ item.fieldSchoolWebpageAddress | url }}" target="_blank">{{ item.fieldSchoolWebpageAddress | removeProtocol }}</a></p>
          </div><!--/scools__item__col-->
          <div class="schools__item__col sm-hide">
            <p *ngIf="item.fieldEducationalInstitutionTy.length > 0 ">
              {{ 'type_of_educational_institution' | translate }}:
              <b>
                <ng-container *ngFor="let type of item.fieldEducationalInstitutionTy">
                  {{ type.entity.entityLabel }}
                </ng-container>
              </b>
            </p>
            <p *ngIf="item.fieldSchoolContactPhone && item.fieldSchoolContactPhone" >{{ 'contact_info' | translate }}: <b *ngIf="item.fieldSchoolContactPhone">{{ item.fieldSchoolContactPhone }}</b><span *ngIf="item.fieldSchoolContactPhone && item.fieldSchoolContactEmail">,</span> <a *ngIf="item.fieldSchoolContactEmail" href="mailto:{{ item.fieldSchoolContactEmail}}">{{ item.fieldSchoolContactEmail}}</a></p>
          </div><!--/scools__item__col-->
      </div><!--/schools__item-->
    </ng-container><!--/list repeat-->
  </div><!--/list-->

  <ng-container *ngIf="view == 'map'">
    <agm-map (mapReady)="mapReady($event)" style="height:525px" *ngIf="list" >
      <agm-marker-cluster [styles]="mapOptions.clusterStyles">>
        <agm-marker [iconUrl]="mapOptions.icon" *ngFor="let marker of list" [latitude]="parseFloat(marker.fieldSchoolLocation[0].entity.fieldCoordinates.lat)"  [longitude]="parseFloat(marker.fieldSchoolLocation[0].entity.fieldCoordinates.lon)">
          <agm-snazzy-info-window [closeWhenOthersOpen]="true">
            <ng-template>
              <p class="title">{{ marker.entityLabel }}</p>
              <p *ngIf="marker.fieldSchoolLocation[0]">{{ 'legal_address' | translate }}: <b>{{ marker.fieldSchoolLocation[0].entity.fieldAddress }}</b></p>
              
              <p *ngIf="marker.fieldEducationalInstitutionTy.length > 0 ">
                  {{ 'type_of_educational_institution' | translate }}:
                  <b>
                    <ng-container *ngFor="let type of marker.fieldEducationalInstitutionTy">
                      {{ type.entity.entityLabel }}
                    </ng-container>
                  </b>
              </p>
              <p *ngIf="marker.fieldSchoolContactPhone && marker.fieldSchoolContactPhone" >{{ 'contact_info' | translate }}: <b *ngIf="marker.fieldSchoolContactPhone">{{ marker.fieldSchoolContactPhone }}</b><span *ngIf="marker.fieldSchoolContactPhone && marker.fieldSchoolContactEmail">,</span> <a *ngIf="marker.fieldSchoolContactEmail" href="mailto:{{ marker.fieldSchoolContactEmail}}"><b>{{ marker.fieldSchoolContactEmail}}</b></a></p>
              <p *ngIf="marker.fieldSchoolWebpageAddress">{{ 'website' | translate }}: <a href="{{ marker.fieldSchoolWebpageAddress }}" target="_blank"><b>{{ marker.fieldSchoolWebpageAddress | removeProtocol }}</b></a></p>
              <a [routerLink]="marker.entityUrl.path" class="button">{{ 'view.more' | translate }}</a>
            </ng-template>
          </agm-snazzy-info-window>
        </agm-marker>
      </agm-marker-cluster>
    </agm-map>
  </ng-container>

</div><!--/schools-->

<div class="text-center actions" *ngIf="!listEnd && view == 'list' && list">
  <mat-spinner *ngIf="loading" diameter="20" style="margin:0 auto;"></mat-spinner>
  <button mat-raised-button color="primary" (click)="loadMore()"  *ngIf="!loading">
    {{ "load.more" | translate }}
  </button>
</div><!--/text-center-->
