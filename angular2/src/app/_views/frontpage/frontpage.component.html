<ng-template #search>
<form class="section__form" [class.focusedError]='!searchFocus && !param && searchError'>
  <div class="flex wrap xxs" role="search">
    <div class="grow">
      <div class="round-input__wrapper" aria-live="assertive" 
        [class.complete]="!searchFocus && param"
        [class.error]="!searchFocus && !param && searchError">
        <label for="param" class="round-input__title" aria-hidden="true">{{'button.search_from_page' | translate}}</label>
        <div class="round-input__field-wrapper">
          <input type="text" 
          attr.aria-label="{{ 'button.search_from_page' | translate }}" 
          class="round-input__field" 
          placeholder="{{ 'button.search_from_page' | translate }}"
          [(ngModel)]='param' 
          (focus)="populateSuggestionList(param, 300);searchError = false;searchFocus = true;"
          (blur)="searchFocus = false"
          role="combobox"
          aria-autocomplete="both"
          autocomplete="off"
          aria-owns="matAutocomplete"
          name="param"
          spellcheck="false"
          id="param"
          [matAutocomplete]="auto"
          (ngModelChange)="populateSuggestionList(param, 300)"/>
          <mat-autocomplete #auto="matAutocomplete"
            role="listbox"
            id="matAutocomplete"
            name="searchParam"
            [(ngModel)]='param' 
            (optionSelected)="autocompleteLoader = false;suggestionList = [];searchRoute(param)">
            <ng-container *ngIf="autocompleteLoader && param">
              <mat-option [value]="" disabled="true">
                <span>{{'search.searching_please_wait' | translate }}</span>
              </mat-option>
            </ng-container>
            <ng-container *ngIf="autocompleteLoader == false && suggestionList && param">
              <mat-option *ngIf="!suggestionList.length" [value]="" disabled="true">
                <span role="alert" *ngIf="param && param.length < 3">{{'search.not_found_required_chars' | translate }}</span>
                <span role="alert" *ngIf="param && param.length >= 3">{{'search.not_found' | translate }}</span>
              </mat-option>
              <ng-container *ngIf="suggestionList.length > 0">
                <mat-option role="option" aria-selected="false" *ngFor="let result of suggestionList; let ind = index;" [value]="result.Suggestion">
                  <span id="{{'option_' + ind" role="option">{{ result.Suggestion }}</span>
                </mat-option>
                <div class="search__alert" role="alert">
                  <span class="search__alert--elem">{{suggestionList.length}} {{'search.suggestions_available' | translate}}</span>
                </div>
              </ng-container>
            </ng-container>
          </mat-autocomplete>
        </div>
        <div class="round-input__error">
          <div class="round-input__error--text error-9" *ngIf="!searchFocus && searchError">
            <span role="alert">{{ 'Otsingu käivitamiseks sisesta otsitav märksõna' }}</span>
          </div>
        </div>
      </div>
    </div>
    <div class="button--wrapper">
      <button (click)="searchRoute(param)" attr.aria-label="{{ 'button.search' | translate }}" mat-raised-button color="primary">{{ 'button.search' | translate}}</button>
    </div>
  </div>
</form>
</ng-template>

<ng-template #origin>
  <article class="row origin" [class.extra-bottom]="!superNewsShown">
    <ng-container *ngFor="let item of generalData[0].fieldTopics; let i = index;">
      <a href="javascript:void(0)" class="col-3 sm-6 xxs-12 column-center spaced pointer" *ngIf="item.entity.fieldTopicLink && item.entity.fieldTopicLink.url.routed" [routerLink]="item.entity.fieldTopicLink.url.path">
        <div class="img__wrapper">
          <div class="htm-icon">book</div>
        </div>
        <div attr.aria-label="{{'frontpage.category' | translate }}" class="section__text--strong">{{item.entity.fieldTopicTitle}}</div>
        <div attr.aria-label="{{'frontpage.description' | translate }}" class="section__text">{{item.entity.fieldTopicText}}</div>
        <span [routerLink]="item.entity.fieldTopicLink.url.path" tabindex="-1" class="section__link">{{ 'button.view_more' | translate }}</span>
      </a> 
      <a *ngIf="item.entity.fieldTopicLink && !item.entity.fieldTopicLink.url.routed" class="col-3 sm-6 xxs-12 column-center spaced pointer" href="{{item.entity.fieldTopicLink.url.path}}" target="_blank">
        <div class="img__wrapper">
          <div class="htm-icon">book</div>
        </div>
        <div attr.aria-label="{{'frontpage.category' | translate }}" class="section__text--strong">{{item.entity.fieldTopicTitle}}</div>
        <div attr.aria-label="{{'frontpage.description' | translate }}" class="section__text">{{item.entity.fieldTopicText}}</div>
        <span target="_blank" tabindex="-1" class="section__link">{{ 'button.view_more' | translate }}</span>
      </a>
      <div class="col-3 sm-6 xxs-12 column-center spaced" *ngIf="!item.entity.fieldTopicLink && (item.entity.fieldTopicTitle || item.entity.fieldTopicText)">
        <!-- <img alt="Info õppimise kohta" src="{{'../../assets/img/frontpage-ikoon'}}{{i + 1}}{{'.svg'}}"> -->
        <div class="img__wrapper">
          <div class="htm-icon">book</div>
        </div>
        <div attr.aria-label="{{'frontpage.category' | translate }}" class="section__text--strong">{{item.entity.fieldTopicTitle}}</div>
        <div attr.aria-label="{{'frontpage.description' | translate }}" class="section__text">{{item.entity.fieldTopicText}}</div>
      </div> 
    </ng-container>
  </article>
</ng-template>

<ng-template #newsItem>
  <article class="news-list__recent__elem">
    <div class="title">{{ 'news.label' | translate | uppercase }}</div>
    <div attr.aria-label="{{ 'news.title' | translate }}"><a href="javascript:void();" class="normal-text" [routerLink]="generalData[0].fieldSupernews.entity.entityUrl.path"><h1> {{ generalData[0].fieldSupernews.entity.title }}</h1></a></div>
    <div attr.aria-label="Author" class="author">{{ generalData[0].fieldSupernews.entity.fieldAuthor }} {{ generalData[0].fieldSupernews.entity.created*1000 | date:"dd.MM.yyyy" }}</div>
  </article>
</ng-template>

<ng-template #newsItemMobile>
  <article class="news-list__recent__elem main-container">
    <div class="title">{{ 'news.label' | translate | uppercase }}</div>
    <div attr.aria-label="{{ 'news.title' | translate }}"><a href="javascript:void();" class="normal-text" [routerLink]="generalData[0].fieldSupernews.entity.entityUrl.path"><h1> {{ generalData[0].fieldSupernews.entity.title }}</h1></a></div>
    <div attr.aria-label="Author" class="author">{{ generalData[0].fieldSupernews.entity.fieldAuthor }} {{ generalData[0].fieldSupernews.entity.created*1000 | date:"dd.MM.yyyy" }}</div>
  </article>
</ng-template>

<ng-template #eventsList>
  <div class="events__recent__elem">
    <article class="row">
      <div class="col-12 title">
        <span>{{ 'event.label' | translate | uppercase }}</span>
        <span class="view-all"><a attr.aria-label="{{ 'button.view_all' | translate }}: {{ 'event.label' | translate }}" [routerLink]="eventPath" href="javascript:void(0);">{{ 'button.view_all' | translate }}</a></span>
      </div>
      <a href="javascript:void();" class="col-4 sm-12 pointer event__elem" *ngFor="let item of events; let first = first;" [routerLink]="[item.entityUrl.path]">

        <span attr.aria-label="{{'event.start_time' | translate}}" class="subtext" *ngIf="item.fieldEventMainDate">{{ item.fieldEventMainDate.unix*1000 | date: "dd.MM.yyyy" }}</span>
        <h1 class="event-title">{{ item.entityLabel }}</h1>
        <div class="subtext--bottom" *ngIf="item.fieldOrganizer" attr.aria-label="{{'event.participant_organization' | translate}}">{{ item.fieldOrganizer }}</div>
      </a>
    </article>
  </div>
</ng-template>

<ng-template #eventsListMobile>
  <div class="main-container">
    <article class="row events__recent__elem">
      <div class="col-12 title">
        <span>{{ 'event.label' | translate | uppercase }}</span>
        <span class="view-all"><a attr.aria-label="{{ 'button.view_all' | translate }}: {{ 'event.label' | translate }}" [routerLink]="eventPath" href="javascript:void(0);">{{ 'button.view_all' | translate }}</a></span>
      </div>
      <a href="javascript:void();" class="col-4 sm-12 pointer event__elem" *ngFor="let item of events; let first = first;" [routerLink]="[item.entityUrl.path]">
          <span attr.aria-label="{{'event.start_time' | translate}}" class="subtext" *ngIf="item.fieldEventMainDate">{{ item.fieldEventMainDate.unix*1000 | date: "dd.MM.yyyy" }}</span>
          <h1>{{ item.entityLabel }}</h1>
          <div class="subtext--bottom" *ngIf="item.fieldOrganizer" attr.aria-label="{{'event.participant_organization' | translate}}">{{ item.fieldOrganizer }}</div>
        </a>
      </article>
    </div>
  </ng-template>
  <mat-spinner *ngIf="!events || !news || !generalData" ></mat-spinner>
  <div class="frontpage" *ngIf="events && news && generalData">
    <div class="section section--search">
      <div class="content--middle search">
        <h1 class="lead-title">
          <span class="sm-show xxs" innerHtml="{{'frontpage.lead_title_xxs' | translate}}"></span>
          <span class="sm-show sm" innerHtml="{{ 'frontpage.lead_title_sm' | translate }}"></span>
          <span class="sm-hide" innerHtml="{{ 'frontpage.lead_title' | translate }}"></span>
        </h1>
        <div class="section__block--search">
          <div class="section__content">
            <ng-container *ngTemplateOutlet="search"></ng-container>
          </div>
        </div>
        <div class="col-12 header">
          <h1 [class.missing-content]="generalData[0].fieldTopics && (!generalData[0].fieldTopics[0].entity.fieldTopicText && !generalData[0].fieldTopics[0].entity.fieldTopicTitle) && superNewsShown">{{generalData[0].fieldHeadBlockTitle}}</h1>
        </div>
      </div>
    </div>
    <div class="section section--origin main-container" *ngIf="generalData && generalData.length">
      <div class="content">
        <ng-container *ngTemplateOutlet="origin"></ng-container>
      </div>
    </div>
    <!-- <div class="section section--list--item sm-show" *ngIf="generalData && generalData.length && generalData[0].fieldSupernews && superNewsShown">
      <div class="content--overlapGrid">
        <img class="content--img atStart" alt="Info õppimise kohta" src="{{'../../assets/img/frontpage-ikoon1.svg'}}">
        <div class="content--listItem atEnd">
          <ng-container *ngTemplateOutlet="newsItemMobile"></ng-container>
        </div>
      </div>
    </div> -->
    <div class="section section--list--item main-container" *ngIf="generalData && generalData.length && generalData[0].fieldSupernews && superNewsShown">
      <!-- <div class="content--listItem">
        <ng-container *ngTemplateOutlet="newsItem"></ng-container>
      </div> -->
      <div class="content--overlapGrid">
        <img class="content--img atStart" alt="Info õppimise kohta" src="http://htm.wiseman.ee/sites/default/files/styles/crop_small/public/2018-09/3_1.jpg?itok=321xUmE_">
        <div class="content--listItem atEnd">
          <ng-container *ngTemplateOutlet="newsItem"></ng-container>
        </div>
      </div>
    </div>
    <div class="section section--newsletter">
      <div class="content--middle newsletter">
        <div class="section__block--newsletter">
          <div class="section__content">
            <newsletter-order></newsletter-order>
          </div>
        </div>
      </div><!--/main-container-->
    </div><!--/section-->
    <div class="section section--news main-container" *ngIf="news && news.length">
      <div class="content">
        <recent-news frontpage="true" [data]="news"></recent-news>
      </div>
    </div>
    <div class="section section--list--item main-container" *ngIf="generalData && generalData.length && generalData[0].fieldSupernews && superNewsShown">
      <!-- <div class="content--listItem">
        <ng-container *ngTemplateOutlet="newsItem"></ng-container>
      </div> -->
      <div class="content--overlapGrid">
        <div class="content--listItem atStart">
          <ng-container *ngTemplateOutlet="newsItem"></ng-container>
        </div>
        <img class="content--img atEnd" alt="Info õppimise kohta" src="http://htm.wiseman.ee/sites/default/files/styles/crop_small/public/2018-09/3_1.jpg?itok=321xUmE_">
      </div>
    </div>
    <div class="section section--list altered main-container sm-hide" *ngIf="events && events.length">
      <div class="content--listItem content--listItem--altered">
        <ng-container *ngTemplateOutlet="eventsList"></ng-container>
      </div>
    </div>
    <div class="section section--list altered sm-show" *ngIf="events && events.length">
      <div class="content--listItem content--listItem--altered">
        <ng-container *ngTemplateOutlet="eventsListMobile"></ng-container>
      </div>
    </div>
    <div class="frontpage__triangle--bottom"></div>
  </div><!--/frontpage-->

