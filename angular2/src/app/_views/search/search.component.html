<div class="row sm-hide crumbs" attr.aria-label="{{'breadcrumbs.breadcrumb' | translate}}">
  <div class="col-12">
    <ul role="link" class="main-container breadcrumb mt-0 mb-0" *ngIf="breadcrumbs && !loading">
      <li *ngFor="let breadcrumbEl of breadcrumbs; let last = last">
        <a [routerLink]="[breadcrumbEl.url]" *ngIf="!last">
          <span role="link">{{ breadcrumbEl.text }}</span>
        </a>
        <span role="dialog" attr.aria-current="{{'page'}}" *ngIf="last">{{ breadcrumbEl.text | ellipsis:30 }}</span>
      </li>
    </ul>
  </div>
</div>

<form (submit)="getResults(param, [])" class="filter-wrapper">
  <div class="main-container">
    <div class="flex wrap">
      <div class="grow full">
        <div class="round-input__wrapper" [class.complete]="param">
          <label for="param" class="round-input__title">{{'search.keyword' | translate}}</label>
          <div class="round-input__field-wrapper">
            <input type="text"
            attr.aria-label="{{ 'button.search_from_page' | translate }}" 
            class="round-input__field" placeholder="{{'search.keyword' | translate}}" 
            [(ngModel)]='param'
            spellcheck="false"
            (focus)="populateSuggestionList(param, 300)"
            role="combobox"
            aria-autocomplete="both"
            autocomplete="off"
            aria-owns="matAutocomplete"
            name="param" 
            id="param"
            [matAutocomplete]="auto"
            (ngModelChange)="populateSuggestionList(param, 300)"/>
            <mat-autocomplete #auto="matAutocomplete" 
              tabindex="0"
              role="listbox"
              id="matAutocomplete"
              aria-activedescendant="option_0"
              (optionSelected)="autocompleteLoader = false;suggestionList = [];getResults(param, [])">
              <ng-container *ngIf="autocompleteLoader && param">
                <mat-option [value]="" disabled="true">
                  <span>{{'search.searching_please_wait' | translate }}</span>
                </mat-option>
              </ng-container>
              <ng-container *ngIf="autocompleteLoader == false && suggestionList && param">
                <mat-option *ngIf="!suggestionList.length" [value]="" disabled="true">
                  <span role="alert" *ngIf="param && param.length < 3">{{'search.not_found_required_chars' | translate }}</span>
                  <span role="alert" *ngIf="param && param.length >= 3">{{'search.not_found' | translate }}</span>
                </mat-option>
                <ng-container *ngIf="suggestionList.length > 0">
                  <mat-option role="option" aria-selected="false" *ngFor="let result of suggestionList; let ind = index;" [value]="result.Suggestion">
                    <span id="{{'option_' + ind}}" role="option">{{ result.Suggestion }}</span>
                  </mat-option>
                  <div class="search__alert" role="alert">
                    <span class="search__alert--elem">{{suggestionList.length}} {{'search.suggestions_available' | translate}}</span>
                  </div>
                </ng-container>
              </ng-container>
            </mat-autocomplete>
          </div>
        </div>
      </div>
      <div class="btn">
        <button attr.aria-label="{{ 'button.search' | translate }}" mat-raised-button color="primary">{{ 'button.search' | translate}}</button>
      </div>
    </div>
  </div>
</form>
<div class="main-container">
  <div class="search" [class.with-results]="filteredResults && filteredResults.length">
    <div class="search__body">
      <div class="search__title">{{ 'search.results' | translate | uppercase }}</div>
      <div #content *ngIf="filteredResults && filteredResults.length" class="search__title--filter">{{ 'search.filter_results' | translate }}:</div>
      <ng-container *ngIf="filteredResults && filteredResults.length">
        <div class="search__chips" role="group" attr.aria-label="Search filter">
          <a role="alert" id="initial" (keyup.enter)="filterAll()" (click)="filterAll()" *ngIf="results && results.length" href="javascript:void(0)" attr.aria-label="{{'button.all' | translate}} {{'search.results' | translate}}, status: {{allFilters ? 'On': 'Off'}}, count: {{ results.length }}" class="search__chips--chip pointer" [class.selected]="allFilters">{{'button.all' | translate}} <span>({{results.length}})</span></a>
          <ng-container *ngFor="let chip of types; let i = index;">
            <a role="button" *ngIf="chip.sum" href="javascript:void(0)" attr.aria-label="Filter: {{chip.name | translate}}, status: {{chip.value ? 'On': 'Off'}}, count: {{ chip.sum }}" (click)="filterView(i)" class="search__chips--chip pointer" [class.selected]="chip.value">{{chip.name | translate}} <span>({{chip.sum}})</span></a>
          </ng-container>
        </div>
      </ng-container>
      <loader *ngIf="loading"></loader>
      <ng-container *ngIf="filteredResults && filteredResults.length">
        <ng-container *ngFor="let item of filteredResults;let i = index;">
          <a tabindex="0" id="{{i}}" href="javascript:void(0)" *ngIf="i < listLimit" class="search__sub pointer" [routerLink]="[item.EntityPath]">  
            <div class="search__sub--category" aria-hidden="true">{{ item.ContentType }}</div>
            <div class="search__sub--title" attr.aria-label="{{ item.ContentType }} {{ item.Title }}:"><h1>{{ item.Title }}</h1></div>
            <div class="inline__items" *ngIf="item.ContentType === 'Õppekava'">
              <span class="item" *ngIf="item.FieldSchoolName">{{ item.FieldSchoolName }}</span>
              <span class="bar" *ngIf="item.FieldSchoolName && item.FieldStudyProgrammeLevel" aria-hidden="true">|</span>
              <span class="item" *ngIf="item.FieldStudyProgrammeLevel">{{ item.FieldStudyProgrammeLevel }}</span>
              <span class="bar" *ngIf="(item.FieldStudyProgrammeLevel || item.FieldSchoolName) && item.FieldDuration" aria-hidden="true">|</span>
              <span class="item" *ngIf="item.FieldDuration">
                <span *ngIf="item.FieldDuration >= 12">{{ (item.FieldDuration - (item.FieldDuration % 12)) / 12 }} <span>{{ item.FieldDuration >= 24 ? 'aastat' : 'aasta' }}</span></span>
                <span *ngIf="item.FieldDuration > 0 && item.FieldDuration % 12 > 0"> {{ item.FieldDuration % 12 }} <span>{{ item.FieldDuration % 12 >= 2 ? 'kuud' : 'kuu' }}</span></span>
              </span>
            </div>
          </a><!--ngFor-->
        </ng-container>
      </ng-container>
    </div><!--/search__body-->
    <div class="text-center actions__error" *ngIf="!loading && filteredResults !== null && filteredResults.length === 0">
      <div class="alert text-center" role="alert">{{'search.no_results_start' | translate}} <span *ngIf="route.snapshot.queryParams['term']">"{{route.snapshot.queryParams['term']}}" </span><span innerHtml="{{'search.no_results_end' | translate}}"></span></div>
    </div><!--/text-center-->
    <div class="text-center actions__error" *ngIf="!loading && !filteredResults">
      <div class="alert text-center" role="alert">{{ 'news.no_results' | translate }}</div>
    </div><!--/text-center-->
  </div>
  <div class="text-center actions" *ngIf="listLength > listLimit && filteredResults && filteredResults.length">
    <button mat-raised-button color="primary" (click)="loadMore()" role="button" >{{ 'button.load_more' | translate }}</button>
  </div><!--/text-center-->
</div>


