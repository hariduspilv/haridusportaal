<div><breadcrumbs *ngIf="!inputData"></breadcrumbs></div>
<div class="sm-show text-right filter-control">
  <a href="javascript:void(0);" (click)="showFilter = !showFilter">
    <span *ngIf="!showFilter">{{ 'button.filter' | translate }}</span>
    <span *ngIf="showFilter">{{ 'button.filter_close' | translate }}</span>
  </a> 
</div>
<form (submit)="filterSubmit($event)" class="filter-wrapper" *ngIf="showFilter">
  <div class="main-container">
    <div class="row form-first-row" [class.short-filter]="!filterFull">
      <div class="col-4 sm-12 form-col">
        <div class="round-input__wrapper">
          <mat-form-field>
            <mat-select placeholder="{{ 'oska.title_field' | translate }}" [(ngModel)]='filterFormItems.field' name="field">
              <mat-option>{{ 'button.all' | translate }}</mat-option>
              <mat-option *ngFor="let item of filterItemValues.field" [value]="item">
                {{item | titleCase}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div><!--/round-inpuit__wrapper-->
      </div><!--/col-4-->
      <div class="col-5 sm-12 form-col">
        <div class="round-input__wrapper">
          <mat-form-field>
            <mat-select placeholder="{{ 'oska.table_responsible_person' | translate }}" [(ngModel)]='filterFormItems.responsible' name="responsible">
              <mat-option>{{ 'button.all' | translate }}</mat-option>
              <mat-option *ngFor="let item of filterItemValues.responsible" [value]="item">
                {{item | titleCase}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div><!--/col-4-->
      <div class="col-3 align-end text-right sm-12 inline-flex form-col" *ngIf="!filterFull">
        <div class="align-center filter-state sm-hide">       
          <a role="button" href="javascript:void(0);" (click)="filterFull = !filterFull" aria-expanded="false">
            <span>Täpsem otsing</span>
          </a>
        </div>
        <div class="button-row">
          <button role="button" mat-raised-button color="primary">{{ 'button.search' | translate}}</button>
        </div>
      </div><!--/col-3-->
    </div><!--/row-->
    <ng-container *ngIf="filterFull">
      <div class="row form-additional-row">
        <div class="col-9 sm-12 form-col">
          <div class="round-input__wrapper">
            <mat-form-field>
              <mat-select placeholder="{{ 'oska.table_proposition_status' | translate }}" [(ngModel)]='filterFormItems.proposalStatus' name="proposalStatus">
                <mat-option>{{ 'button.all' | translate }}</mat-option>
                <mat-option *ngFor="let item of filterItemValues.proposalStatus" [value]="item">
                  {{item | titleCase}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div><!--/col-9-->
        <div class="col-3 align-end text-right sm-12 inline-flex form-col">
          <div class="align-center filter-state sm-hide">       
            <a role="button" href="javascript:void(0);" (click)="filterFull = !filterFull" aria-expanded="true">
              <span>{{ 'button.search_brief' | translate }}</span>
            </a>
          </div>
          <div class="button-row">
            <button role="button" mat-raised-button color="primary">{{ 'button.search' | translate}}</button>
          </div>
        </div><!--/col-3-->
      </div><!--/row-->
    </ng-container>
  </div>
</form>
<div class="main-container">
  <div class="row wrapper__row" *ngIf="error">
    <div class="col-12">
      <div class="block border-blue padding-block">
        <div class="block__head no-border">
          <div class="block__head__title">{{ 'oska.results' | translate | uppercase }}</div>
        </div><!--/block__head-->
        <h1>{{ 'oska.results' | translate }}</h1>
        <div class="text-center actions__error">
          <div class="alert" role="alert">{{'errors.request' | translate}}</div>
        </div><!--/text-center-->
      </div>
    </div>
  </div>
  <mat-spinner *ngIf="!tableData && !error"></mat-spinner>
  <div class="row wrapper__row" *ngIf="tableData">
    <div class="col-12">
      <div class="block border-blue padding-block lg-bottom" id="tableElem" *ngIf="filteredTableData && tableData && tableData.length">
        <div class="block__head no-border">
          <div class="block__head__title">{{ 'oska.results' | translate | uppercase }}</div>
        </div><!--/block__head-->
        <div class="row">
          <div class="col sm-8 flex">
            <h1>{{ 'oska.proposal_title' | translate }}</h1>
            <!-- <h1 class="block-heading">{{ 'oskaProfessions.compare_label' | translate | titleCase }}</h1> -->
          </div>
          <div class="col sm-4 flex flex-center flex-justify-end action--back" *ngIf="filteredTableData && filteredTableData.length && tableFile">
            <div class="link-holder">
              <a href="{{ tableFile.fieldResultPageTableFile.entity.url }}" target="_blank" attr.aria-label="{{ 'button.download_table' | translate }}: {{ tableFile.fieldResultPageTableFile.description || tableFile.fieldResultPageTableFile.entity.entityLabel }}">
                <span>{{ 'button.download_table' | translate }}</span>
                <!-- <span class="sm-show">{{ 'button.download_table' | translate }}</span> -->
              </a>
            </div>
          </div>
        </div>
        <div class="text-center actions__error" *ngIf="filteredTableData && !filteredTableData.length">
          <div class="alert" role="alert">{{'search.no_results_start' | translate}} <span innerHtml="{{'search.no_results_end' | translate}}"></span></div>
        </div><!--/text-center-->
        <div class="scrollable" *ngIf="filteredTableData && filteredTableData.length">
          <div aria-hidden="true" class="scrollable__rectangle scrollable__rectangle--left withState pointer" id="scrollableLeft" [class.withState--active]="!elemAtStart" 
            (touchstart)="tableService.scrollStart('resultsTable')" 
            (mousedown)="tableService.scrollStart('resultsTable')" 
            (touchend)="tableService.scrollEnd()" 
            (mouseup)="tableService.scrollEnd()">
            <span class="htm-icon">keyboard_arrow_left</span>
          </div>
          <div aria-hidden="true" class="scrollable__rectangle scrollable__rectangle--right withState pointer" id="scrollableRight" [class.withState--active]="tableOverflown" 
            (touchstart)="tableService.scrollStart('resultsTable', true)"
            (mousedown)="tableService.scrollStart('resultsTable', true)"
            (touchend)="tableService.scrollEnd(true)"
            (mouseup)="tableService.scrollEnd(true)">
            <span class="htm-icon">keyboard_arrow_right</span>
          </div>
          <div class="scrollable__table" id="resultsTable" (scroll)="tableOverflown = tableService.isOverflownWhileScrolling($event); elemAtStart = tableService.isElemAtStart('resultsTable');setScrollPos('resultsTable')">
            <table class="dashboard-table scrollableTable">
              <thead>
                <tr>
                  <th scope="col" class="pointer" (click)="sortView('field');setAlert('oska.title_field')">
                    <span>{{ 'oska.title_field' | translate }}</span>
                    <a href="javascript:void(0)" attr.aria-label="{{'button.sortable' | translate}}">
                      <span class="icon" aria-hidden="true">
                        <span *ngIf="field === 'field' && modifier" class="htm-icon">keyboard_arrow_up</span>
                        <span *ngIf="field && !(field === 'field' && modifier)" class="htm-icon">keyboard_arrow_down</span>
                      </span>
                    </a>
                  </th>
                  <!-- <th>{{ 'oska.table_problem' | translate }}</th> -->
                  <th scope="col">{{ 'oska.table_proposition' | translate }}</th>
                  <th scope="col" class="pointer" (click)="sortView('responsible');setAlert('oska.table_responsible_person')">
                    <span>{{ 'oska.table_responsible_person' | translate }}</span>
                    <a href="javascript:void(0)" role="button" attr.aria-label="{{'button.sortable' | translate}}">
                      <span class="icon" aria-hidden="true">
                        <span *ngIf="field === 'responsible' && modifier" class="htm-icon">keyboard_arrow_up</span>
                        <span *ngIf="field && !(field === 'responsible' && modifier)" class="htm-icon">keyboard_arrow_down</span>
                      </span>
                    </a>
                  </th>
                  <th scope="col" class="pointer" (click)="sortView('proposalStatus');setAlert('oska.table_proposition_status')">
                    <span>{{ 'oska.table_proposition_status' | translate }}</span>
                    <a href="javascript:void(0)" role="button" attr.aria-label="{{'button.sortable' | translate}}">
                      <span class="icon" aria-hidden="true">
                        <span *ngIf="field === 'proposalStatus' && modifier" class="htm-icon">keyboard_arrow_up</span>
                        <span *ngIf="field && !(field === 'proposalStatus' && modifier)" class="htm-icon">keyboard_arrow_down</span>
                      </span>
                    </a>
                  </th>
                  <th aria-hidden="true" class="separator" *ngIf="!commentVisible"></th>
                  <th scope="col" class="pointer" [class.hidden]="!commentVisible">
                    <span tabindex="0" role="button"
                      (keyup.enter)="commentVisible = !commentVisible;;elemAtStart = tableService.isElemAtStart('resultsTable');tableOverflown = tableService.isElemOverflown('resultsTable');setAlert()"
                      (click)="commentVisible = !commentVisible;;elemAtStart = tableService.isElemAtStart('resultsTable');tableOverflown = tableService.isElemOverflown('resultsTable');setAlert()">
                      <span *ngIf="commentVisible" attr.aria-label="{{ 'button.close' | translate }} {{ 'oska.table_experts_comment' | translate }}">{{ 'oska.table_experts_comment' | translate }}</span>
                      <span class="icon visible__elem" aria-hidden="true" *ngIf="commentVisible">
                        <span class="htm-icon">skip_previous</span>
                      </span>
                      <span *ngIf="!commentVisible" attr.aria-label="{{ 'button.open' | translate }} {{ 'oska.table_experts_comment' | translate }}"></span>
                      <span *ngIf="!commentVisible" aria-hidden="true">
                        <span class="htm-icon nonvisible__elem">skip_next</span>
                      </span>
                    </span>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of filteredTableData; let first = first; let last = last;">
                  <td class="narrow">
                    <div *ngIf="item.oskaField && item.oskaField[0]">{{ item.oskaField[0].entity.title }}</div>
                  </td>
                  <!-- <td class="wide">
                    <div *ngIf="item.problemDescription">{{item.problemDescription}}</div>
                  </td> -->
                  <td class="wide">
                    <div id="limitedData" *ngIf="item.proposal">{{item.proposal}}</div>
                    <div aria-hidden="true" class="text-center hidden show-more"><a (click)="removeLimiter($event)" aria-hidden="true" role="button" href="javascript:void(0)">{{'button.see_more' | translate}}</a></div>
                  </td>
                  <td class="narrow">
                    <div *ngIf="item.responsible">{{item.responsible}}</div>
                  </td>
                  <td class="narrow">
                    <!-- <div *ngIf="item.proposalStatus">{{item.proposalStatus}}</div> -->
                    <div class="flex centered">
                      <div class="icon-wrapper"
                        [class.stagnant]="item.proposalStatus == 'Töös'"
                        [class.top]="item.proposalStatus == 'Tehtud'"
                        [class.bottom]="item.proposalStatus == 'Tegemata'">
                        <span class="icon" aria-hidden="true"></span>
                      </div>
                      <div class="flex-text"><span role="text" attr.aria-label="{{item.proposalStatus}}">{{item.proposalStatus}}</span></div>
                    </div>
                  </td>
                  <ng-container>
                    <td aria-hidden="true" class="separator" *ngIf="!commentVisible"></td>
                    <td *ngIf="!commentVisible" class="hidden vertical pointer" [class.last]="last" (click)="commentVisible = !commentVisible;elemAtStart = tableService.isElemAtStart('resultsTable');tableOverflown = tableService.isElemOverflown('resultsTable');setAlert()">
                      <span class="vertical__text" *ngIf="first">{{ 'oska.table_experts_comment' | translate }}</span>
                      <span role="button" class="vertical__text" *ngIf="!first"></span>
                      <!-- attr.aria-label="{{ 'button.open' | translate }} {{ 'oska.table_experts_comment' | translate }}" -->
                    </td>
                    <td *ngIf="commentVisible" class="wide--extra" [class.last]="last">
                      <span *ngIf="commentVisible && item.expertCommentary">{{ item.expertCommentary }}</span>
                    </td>
                  </ng-container>
                </tr>
              </tbody>
            </table>
            <div class="notification--alert" role="alert">
              <span *ngIf="alertText">{{alertText}}</span>
            </div>
          </div>
        </div>

        <!-- <feedback [nid]="data.nid"></feedback> -->
        
      </div><!--/block-->

    </div><!--/col-8-->
  </div><!--/row-->
</div><!--/main-container-->