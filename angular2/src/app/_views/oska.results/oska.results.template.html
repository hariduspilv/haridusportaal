<breadcrumbs></breadcrumbs>
<div class="main-container">
  <div class="row wrapper__row" *ngIf="error">
    <div class="col-8 sm-12">
      <div class="block border-blue padding-block first-block">
        <h1>{{ 'oska.results' | translate }}</h1>
        <div class="text-center actions__error">
          <div class="alert" role="alert">{{'errors.request' | translate}}</div>
        </div><!--/text-center-->
      </div>
    </div>
  </div>
  <mat-spinner *ngIf="!data && !error"></mat-spinner>
  <div class="row wrapper__row" *ngIf="data">
    <div class="col-8 sm-12">
      <div class="block border-blue padding-block first-block">
        <div class="block__head no-border">
          <div class="block__head__title">{{ data['entityLabel'] | uppercase }}</div>
        </div><!--/block__head-->

        <h1>{{ 'oska.results' | translate }}</h1>
        <div class="mininav flex text-right">
          <favourites *ngIf="!userLoggedOut" [id]="data.nid" [title]="data.entityLabel"></favourites>
          <share></share>
        </div>  
        <div class="short" [attr.aria-label]="'description.short' | translate">
          {{ data['fieldResultPageIntroduction']}}
        </div>

        <!-- field image-->
        <ng-container *ngIf="data.fieldResultPagePicture">
          <ng-container *ngIf="data.fieldResultPagePicture.length > 0">
            <div class="article-image pull-right" *ngFor="let picture of data.fieldResultPagePicture">
              <img src="{{ picture.derivative.url }}" alt="{{ picture.alt }}" title="{{ picture.title }}" style="max-width:100%;" />
              <div aria-hidden="true" class="image-alt-text" *ngIf="picture.title">{{ picture.title }}</div>
            </div><!--/fieldOskaFieldPicture-->
          </ng-container>
        </ng-container>

        <div [innerHTML]="data['body']['value']" attr.aria-label="{{'description' | translate}}" class="description" ></div>

        <ng-container *ngIf="data.fieldResultPageLinks || data.fieldResultPageFiles">
          <ng-container *ngIf="data.fieldResultPageLinks.length > 0 || data.fieldResultPageFiles.length > 0" class="external-links">
            <ul class="external-links">
              <li *ngFor="let item of data.fieldResultPageLinks">
                <a href="{{ item.url.path }}" target="_blank" attr.aria-label="{{ item.title }}" ><span class="htm-icon">launch</span>{{ item.title }}</a>
              </li>
              <li *ngFor="let item of data.fieldResultPageFiles">
                <a href="{{ item.entity.url }}" target="_blank" attr.aria-label="{{ item.description || item.entity.entityLabel }}" ><span class="htm-icon">file_copy</span>{{ item.description || item.entity.entityLabel }}</a>
              </li>
            </ul>
          </ng-container>
        </ng-container>

        <ng-container *ngIf="data.fieldResultPageVideo">
          <video-component [videos]="data.fieldResultPageVideo"></video-component>
        </ng-container>

        <ng-container *ngIf="data.fieldResultPageGraph">
          <chart [data]="data.fieldResultPageGraph"></chart>
        </ng-container>
        
      </div><!--/block-->
    </div><!--/col-8-->

    <div class="col-4 sm-12" *ngIf="sidebarData">
      <oska-areas-sidebar [sidebar]="sidebarData" [viewType]="viewType"></oska-areas-sidebar>
    </div><!--/col-4-->
  
    <div class="col-8 sm-12" *ngIf="filteredTableData">
      <div class="block border-blue padding-block lg-bottom" id="tableElem">
        <div class="block__head no-border">
          <div class="block__head__title">{{ 'TULEMUSTE TABEL' | uppercase }}</div>
        </div><!--/block__head-->
        <div class="flex flex-wrap flex-rows first-elem">
          <div class="flex flex-wrap flex-notrows flex-grow">
            <div class="flex input-row no-top">
              <div class="grow additional">
                <div class="round-input__wrapper">
                  <mat-form-field *ngIf="filterItemValues && filterItemValues.field.length">
                    <mat-select placeholder="{{ 'oska.title_field' | translate }}" [(ngModel)]='filterItems.field' name="field">
                      <mat-option>{{ 'button.all' | translate }}</mat-option>
                      <mat-option *ngFor="let item of filterItemValues.field" [value]="item">
                        {{item}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div><!--grow-->
              <div class="grow">
                <div class="round-input__wrapper">
                  <mat-form-field *ngIf="filterItemValues && filterItemValues.responsible.length">
                    <mat-select placeholder="{{ 'oska.table_responsible_person' | translate }}" [(ngModel)]='filterItems.responsible' name="responsible">
                      <mat-option>{{ 'button.all' | translate }}</mat-option>
                      <mat-option *ngFor="let item of filterItemValues.responsible" [value]="item">
                        {{item}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div><!--grow-->
            </div><!--flex-->
            <div class="flex input-row no-bottom">
              <div class="grow">
                <div class="round-input__wrapper">
                  <mat-form-field *ngIf="filterItemValues && filterItemValues.proposalStatus.length">
                    <mat-select placeholder="{{ 'oska.table_proposition_status' | translate }}" [(ngModel)]='filterItems.proposalStatus' name="proposalStatus">
                      <mat-option>{{ 'button.all' | translate }}</mat-option>
                      <mat-option *ngFor="let item of filterItemValues.proposalStatus" [value]="item">
                        {{item}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div><!--grow-->
            </div><!--flex-->
          </div><!--flex flex-notrows-->
          <div class="sm-12 align-end">
            <div class="button-row">
              <button (click)="filterView()" type="button" mat-raised-button color="primary">{{ 'button.search' | translate}}</button>
            </div>
          </div><!--/sm-12-->
        </div><!--flex flex-rows first-elem-->
        <div class="download" *ngIf="data.fieldResultPageTableFile">
          <a href="{{ data.fieldResultPageTableFile.entity.url }}" target="_blank" attr.aria-label="{{ data.fieldResultPageTableFile.description || data.fieldResultPageTableFile.entity.entityLabel }}" >
            <span matTooltip="{{ 'button.download' | translate }}" matTooltipPosition="top" class="htm-icon">publish</span>
          </a>
        </div>
        <div class="text-center actions__error" *ngIf="filteredTableData && !filteredTableData.length">
          <div class="alert" role="alert">{{'search.no_results_start' | translate}} <span innerHtml="{{'search.no_results_end' | translate}}"></span></div>
        </div><!--/text-center-->
        <div class="scrollable" *ngIf="filteredTableData && filteredTableData.length">
          <div aria-hidden="true" class="scrollable__rectangle scrollable__rectangle--left pointer" id="scrollableLeft" *ngIf="!elemAtStart" 
            (touchstart)="tableService.scrollStart('resultsTable')" 
            (mousedown)="tableService.scrollStart('resultsTable')" 
            (touchend)="tableService.scrollEnd()" 
            (mouseup)="tableService.scrollEnd()">
            <span class="htm-icon">keyboard_arrow_left</span>
          </div>
          <div aria-hidden="true" class="scrollable__rectangle scrollable__rectangle--right pointer" id="scrollableRight" *ngIf="tableOverflown" 
            (touchstart)="tableService.scrollStart('resultsTable', true)"
            (mousedown)="tableService.scrollStart('resultsTable', true)"
            (touchend)="tableService.scrollEnd(true)"
            (mouseup)="tableService.scrollEnd(true)">
            <span class="htm-icon">keyboard_arrow_right</span>
          </div>
          <div class="scrollable__table" id="resultsTable" (scroll)="tableOverflown = tableService.isOverflownWhileScrolling($event); elemAtStart = tableService.isElemAtStart('resultsTable');setScrollPos('resultsTable')">
            <table class="dashboard-table scrollableTable">
              <thead>
                <tr>
                  <th>
                    <span>{{ 'oska.title_field' | translate }}</span>
                    <a href="javascript:void(0)" attr.aria-label="{{'button.sort' | translate}} {{'button.by' | translate}} {{ 'oska.title_field' | translate }}" (click)="sortView('field')">
                      <span class="icon" aria-hidden="true">
                        <span *ngIf="field === 'field' && modifier" class="htm-icon">keyboard_arrow_up</span>
                        <span *ngIf="field && !(field === 'field' && modifier)" class="htm-icon">keyboard_arrow_down</span>
                      </span>
                    </a>
                  </th>
                  <th>{{ 'oska.table_problem' | translate }}</th>
                  <th>{{ 'oska.table_proposition' | translate }}</th>
                  <th>
                    <span>{{ 'oska.table_responsible_person' | translate }}</span>
                    <a href="javascript:void(0)" attr.aria-label="{{'button.sort' | translate}} {{'button.by' | translate}} {{ 'oska.table_responsible_person' | translate }}" (click)="sortView('responsible')">
                      <span class="icon" aria-hidden="true">
                        <span *ngIf="field === 'responsible' && modifier" class="htm-icon">keyboard_arrow_up</span>
                        <span *ngIf="field && !(field === 'responsible' && modifier)" class="htm-icon">keyboard_arrow_down</span>
                      </span>
                    </a>
                  </th>
                  <th>
                    <span>{{ 'oska.table_proposition_status' | translate }}</span>
                    <a href="javascript:void(0)" attr.aria-label="{{'button.sort' | translate}} {{'button.by' | translate}} {{ 'oska.table_proposition_status' | translate }}" (click)="sortView('proposalStatus')">
                      <span class="icon" aria-hidden="true">
                        <span *ngIf="field === 'proposalStatus' && modifier" class="htm-icon">keyboard_arrow_up</span>
                        <span *ngIf="field && !(field === 'proposalStatus' && modifier)" class="htm-icon">keyboard_arrow_down</span>
                      </span>
                    </a>
                  </th>
                  <th>{{ 'oska.table_experts_comment' | translate }}</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of filteredTableData">
                  <td class="narrow"><div *ngIf="item.oskaField && item.oskaField[0]">{{ item.oskaField[0].entity.title }}</div></td>
                  <td class="wide"><div *ngIf="item.problemDescription">{{item.problemDescription}}</div></td>
                  <td class="wide"><div *ngIf="item.proposal">{{item.proposal}}</div></td>
                  <td class="narrow"><div *ngIf="item.responsible">{{item.responsible}}</div></td>
                  <td class="narrow"><div *ngIf="item.proposalStatus">{{item.proposalStatus}}</div></td>
                  <td class="wide"><div *ngIf="item.expertCommentary">{{item.expertCommentary}}</div></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div><!--/block-->
    </div><!--/col-8-->

  </div><!--/row-->
</div><!--/main-container-->