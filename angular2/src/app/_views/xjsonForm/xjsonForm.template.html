<div>
  <breadcrumbs></breadcrumbs>
</div>
<div class="xjson main-container">
  <div class="block padding-block border-blue">
    <div class="block__head">
      <div class="block__head__title">{{ 'xjson.forms_title' | translate | uppercase }}</div>
    </div>
    <!--/block__head-->

    <loader *ngIf="!data"></loader>

    <ng-container *ngIf="data && view == 'document'">

      <h1 *ngIf="data.body.title">{{ selectLanguage(data.body.title) }}</h1>
      <p class="xjson__introduction" *ngIf="data.body.introduction">{{ selectLanguage(data.body.introduction) }}</p>

      <ng-container *ngIf="data_messages">
        <ng-container *ngFor="let message of data_messages; let i = index;">
          <div class="alert" [ngClass]="'alert__'+data.messages[message].message_type | lowercase">
            {{ selectLanguage(data.messages[message].message_text)}}<button class="alert__close"
              (click)="closeMessage(i)" [attr.aria-label]="'notification.close' | translate"></button></div>
        </ng-container>
      </ng-container>

      <ng-container *ngIf="error_alert">
        <div class="alert" ngClass="alert__error">
          {{ 'xjson.validation_errors' | translate }} <button class="alert__close" (click)="closeError()"
            [attr.aria-label]="'notification.close' | translate"></button></div>
      </ng-container>

      <ul class="xjson__navigation" id="stepNavigation" *ngIf="!data.body.hide_steps">
        <li class="xjson__navigation__step" [attr.id]="step" [class.active]="opened_step === step"
          [class.disabled]="isStepDisabled(step)" *ngFor="let step of objectKeys(data.body.steps)">
          <a (click)="selectStep(step)">
            <span class="xjson__navigation__stepname">
              <ng-container *ngIf="data.body.steps[step].title"> {{ selectLanguage(data.body.steps[step].title) }}
              </ng-container>
            </span>
          </a>
        </li>
      </ul>

      <ng-container *ngIf="!empty_data">
        <span>{{ 'xjson.required_fields_infotext' | translate }}</span>

        <hr class="divider">

        <!-- STEP BODY -->
        <div class="row button-list button-list-top">
          <ng-container *ngFor="let activity of activityButtons['primary']">
            <button *ngIf="activity.action == 'EDIT'" type="submit" role="button" mat-raised-button
              [color]="[activity.style]" (click)="submitForm(activity.action)">
              {{ activity.label | translate }}
            </button>
          </ng-container>
        </div>

        <div class="xjson__step-introduction" *ngIf="data.body.steps[opened_step].introduction">
          {{selectLanguage(data.body.steps[opened_step].introduction) }}
        </div>

        <form [class.disabled-step]="opened_step != this.max_step && !edit_step" (submit)="submitForm()"
          *ngIf="objectKeys(data_elements).length > 0">

          <ng-container *ngFor="let element of objectKeys(data_elements); let index = index;">

            <div [class]="data_elements[element].type != 'file' ? 'row' : 'file-row'"
              *ngIf="!data_elements[element].hidden">
              <!-- Form elements -->

              <div class="col-12 xjson__component">

                <ng-container *ngIf="data_elements[element].type == 'helpertext'">
                  <p *ngIf="data_elements[element].title">
                    {{ selectLanguage(data_elements[element].title) }}
                  </p>
                </ng-container> <!-- /HELPERTEXT (heading) -->

                <ng-container *ngIf="data_elements[element].type == 'heading'">
                  <h1 class="xjson__heading" *ngIf="data_elements[element].title">
                    {{ selectLanguage(data_elements[element].title) }}
                  </h1>
                </ng-container> <!-- /HEADING -->

                <ng-container *ngIf="data_elements[element].type == 'text'">
                  <div class="squared-input__outer-wrapper">
                    <div class="squared-input__wrapper"
                      [class.complete]="data_elements[element].value || opened_step != this.max_step">
                      <span class="squared-input__title">
                        {{ selectLanguage(data_elements[element].title)}}{{data_elements[element].required ? '*': ''}}
                      </span>
                      <div class="squared-input__field-wrapper">
                        <input class="squared-input__field" type="text"
                          placeholder="{{selectLanguage(data_elements[element].title)}}{{data_elements[element].required ? '*': ''}}"
                          [attr.disabled]="isFieldDisabled(data_elements[element].readonly) ? '' : null"
                          [(ngModel)]='data_elements[element].value' [name]="element"
                          [attr.required]="data_elements[element].required" />
                      </div>
                    </div>
                    <!--/squared-input__wrapper-->

                    <div class="helper-wrapper">
                      <ng-container *ngIf="data_elements[element].helpertext">
                        <span class="tooltip" matTooltip="{{ selectLanguage(data_elements[element].helpertext) }}"
                          matTooltipPosition="above">
                        </span>
                      </ng-container> <!-- /HELPERTEXT QUESTIONMARK (?) -->
                    </div>
                  </div>
                </ng-container> <!-- /TEXT -->

                <ng-container *ngIf="data_elements[element].type == 'textarea'">
                  <div class="squared-input__outer-wrapper">
                    <div class="squared-input__wrapper"
                      [class.complete]="data_elements[element].value || opened_step != this.max_step">
                      <span class="squared-input__title">
                        {{ selectLanguage(data_elements[element].title)}}{{data_elements[element].required ? '*': ''}}
                      </span>
                      <div class="squared-input__area">
                        <textarea class="squared-input__area__elem"
                          [attr.disabled]="isFieldDisabled(data_elements[element].readonly) ? '' : null"
                          [(ngModel)]='data_elements[element].value'
                          placeholder="{{selectLanguage(data_elements[element].title)}}{{data_elements[element].required ? '*': ''}}"
                          [name]="element"></textarea>
                      </div>
                    </div>
                    <div class="helper-wrapper">
                      <ng-container *ngIf="data_elements[element].helpertext">
                        <span class="tooltip" matTooltip="{{ selectLanguage(data_elements[element].helpertext) }}"
                          matTooltipPosition="above">
                        </span>
                      </ng-container> <!-- /HELPERTEXT QUESTIONMARK (?) -->
                    </div>
                  </div>
                </ng-container> <!-- /TEXTAREA -->

                <ng-container *ngIf="data_elements[element].type == 'selectlist'">
                  <div class="squared-input__outer-wrapper multiselect-wrapper">
                    <div class="squared-input__wrapper"
                      [class.complete]="data_elements[element].value || opened_step != this.max_step">
                      <span class="squared-input__title">
                        {{selectLanguage(data_elements[element].title)}}{{data_elements[element].required ? '*': ''}}
                      </span>

                      <div class="squared-input__field-wrapper">
                        <mat-select class="squared-input__field"
                          placeholder=" {{selectLanguage(data_elements[element].title)}}{{data_elements[element].required ? '*': ''}}"
                          [(ngModel)]='data_elements[element].value'
                          [disabled]="isFieldDisabled(data_elements[element].readonly)" [name]="element"
                          [multiple]="data_elements[element].multiple">
                          <ng-container *ngIf="!data_elements[element].multiple">
                            <mat-option *ngIf="!data_elements[element].multiple" [value]="undefined">
                              {{ data_elements[element].empty_option ? selectLanguage(data_elements[element].empty_option) : ''}}
                            </mat-option>
                            <ng-container *ngIf="data_elements[element].options">
                              <ng-container *ngFor="let option of objectKeys(data_elements[element].options)">
                                <mat-option *ngIf="!data_elements[element].options[option].options" [value]="option">
                                  {{ selectLanguage(data_elements[element].options[option]) }}
                                </mat-option>

                                <ng-container *ngIf="data_elements[element].options[option].options">
                                  <mat-option disabled="true" [value]="null">
                                    {{ selectLanguage(data_elements[element].options[option]) }}
                                  </mat-option>

                                  <ng-container
                                    *ngFor="let option2 of objectKeys(data_elements[element].options[option].options)">
                                    <!--level 2-->
                                    <mat-option *ngIf="!data_elements[element].options[option].options[option2].options"
                                      [value]="option2">
                                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{selectLanguage(data_elements[element].options[option].options[option2]) }}
                                    </mat-option>

                                    <ng-container
                                      *ngIf="data_elements[element].options[option].options[option2].options">
                                      <mat-option disabled="true" [value]="null">
                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{selectLanguage(data_elements[element].options[option]['options'][option2]) }}
                                      </mat-option>

                                      <ng-container
                                        *ngFor="let option3 of objectKeys(data_elements[element].options[option].options[option2].options)">
                                        <!--level 3-->
                                        <mat-option
                                          *ngIf="!data_elements[element].options[option].options[option2].options[option3].options"
                                          [value]="option3">
                                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{selectLanguage(data_elements[element].options[option].options[option2].options[option3])}}
                                        </mat-option>
                                      </ng-container>
                                    </ng-container>
                                  </ng-container>
                                </ng-container>
                              </ng-container>
                            </ng-container>
                          </ng-container>

                          <ng-container *ngIf="data_elements[element].multiple">
                            <mat-option *ngFor="let option of objectKeys(data_elements[element].options)"
                              [value]="option">
                              {{ selectLanguage(data_elements[element].options[option]) }}
                            </mat-option>
                          </ng-container>
                        </mat-select>
                      </div>
                    </div>
                    <div class="helper-wrapper">
                      <ng-container *ngIf="data_elements[element].helpertext">
                        <span class="tooltip" matTooltip="{{ selectLanguage(data_elements[element].helpertext) }}"
                          matTooltipPosition="above">
                        </span>
                      </ng-container> <!-- /HELPERTEXT QUESTIONMARK (?) -->
                    </div>
                  </div>
                </ng-container> <!-- /SELECTLIST -->

                <ng-container *ngIf="data_elements[element].type == 'email'">
                  <div class="squared-input__outer-wrapper">
                    <div class="squared-input__wrapper"
                      [class.complete]="data_elements[element].value || opened_step != this.max_step">
                      <span class="squared-input__title">
                        {{ selectLanguage(data_elements[element].title)}}{{data_elements[element].required ? '*': ''}}
                      </span>
                      <div class="squared-input__field-wrapper">
                        <input class="squared-input__field" type="email"
                          placeholder="{{selectLanguage(data_elements[element].title)}}{{data_elements[element].required ? '*': ''}}"
                          [attr.disabled]="isFieldDisabled(data_elements[element].readonly) ? '' : null"
                          [(ngModel)]='data_elements[element].value' [name]="element"
                          [attr.required]="data_elements[element].required" />
                      </div>
                    </div>
                    <div class="helper-wrapper">
                      <ng-container *ngIf="data_elements[element].helpertext">
                        <span class="tooltip" matTooltip="{{ selectLanguage(data_elements[element].helpertext) }}"
                          matTooltipPosition="above">
                        </span>
                      </ng-container> <!-- /HELPERTEXT QUESTIONMARK (?) -->
                    </div>
                  </div>
                  <!--/squared-input__wrapper-->
                </ng-container> <!-- /EMAIL -->

                <ng-container *ngIf="data_elements[element].type == 'checkbox'">
                  <div class="squared-input__outer-wrapper checkbox-wrapper">
                    <div class="custom-checkbox">
                      <mat-checkbox [(ngModel)]="data_elements[element].value" [name]="element"
                        [disabled]="isFieldDisabled(data_elements[element].readonly)"
                        [required]="data_elements[element].required">
                        {{ selectLanguage(data_elements[element].title) }}{{data_elements[element].required ? '*': ''}}
                      </mat-checkbox>
                    </div>
                    <div class="helper-wrapper">
                      <ng-container *ngIf="data_elements[element].helpertext">
                        <span class="tooltip" matTooltip="{{ selectLanguage(data_elements[element].helpertext) }}"
                          matTooltipPosition="above">
                        </span>
                      </ng-container> <!-- /HELPERTEXT QUESTIONMARK (?) -->
                    </div>
                  </div>
                </ng-container> <!-- /CHECKBOX -->

                <ng-container *ngIf="data_elements[element].type == 'number'">
                  <div class="squared-input__outer-wrapper">
                    <div class="squared-input__wrapper"
                      [class.complete]="data_elements[element].value != undefined || opened_step != this.max_step">
                      <span class="squared-input__title">
                        {{ selectLanguage(data_elements[element].title)}}{{data_elements[element].required ? '*': ''}}
                      </span>
                      <div class="squared-input__field-wrapper">
                        <input class="squared-input__field" type="text" [min]="data_elements[element].min"
                          [max]="data_elements[element].max"
                          placeholder="{{ selectLanguage(data_elements[element].title)}}{{data_elements[element].required ? '*': ''}}"
                          [(ngModel)]="data_elements[element].value"
                          [attr.disabled]="isFieldDisabled(data_elements[element].readonly) ? '' : null"
                          [name]="element" [attr.required]="data_elements[element].required" />
                      </div>
                    </div>
                    <div class="helper-wrapper">
                      <ng-container *ngIf="data_elements[element].helpertext">
                        <span class="tooltip" matTooltip="{{ selectLanguage(data_elements[element].helpertext) }}"
                          matTooltipPosition="above">
                        </span>
                      </ng-container> <!-- /HELPERTEXT QUESTIONMARK (?) -->
                    </div>
                  </div>
                  <!--/squared-input__wrapper-->
                </ng-container> <!-- /NUMBER -->

                <ng-container *ngIf="data_elements[element].type == 'address'">
                  <div class="squared-input__outer-wrapper">
                    <div class="squared-input__wrapper"
                      [class.complete]="temporaryModel[element] || opened_step != this.max_step">
                      <span class="squared-input__title">
                        {{ selectLanguage(data_elements[element].title) }}{{data_elements[element].required ? '*': ''}}
                      </span>
                      <div class="squared-input__field-wrapper">
                        <input class="squared-input__field" type="text" matInput
                          [disabled]="isFieldDisabled(data_elements[element].readonly)"
                          [(ngModel)]="temporaryModel[element]"
                          placeholder="{{ selectLanguage(data_elements[element].title) }}{{data_elements[element].required ? '*': ''}}"
                          (ngModelChange)="addressAutocomplete(temporaryModel[element], 300, element)"
                          (focus)="addressFieldFocus = true" (blur)="validateInAdsField(element)" [name]="element"
                          [matAutocomplete]="autoAddress">
                        <mat-autocomplete #autoAddress="matAutocomplete" (optionSelected)="addressFieldFocus = false">
                          <ng-container *ngIf="autocompleteLoader">
                            <mat-option [value]="" disabled="true">
                              <span>{{'xjson.searching_please_wait' | translate }}</span>
                            </mat-option>
                          </ng-container>
                          <ng-container *ngIf="autocompleteLoader == falseÂ && autoCompleteContainer[element]">
                            <mat-option *ngIf="!autoCompleteContainer[element].length" [value]="" disabled="true">
                              <span>{{'xjson.address_not_found' | translate }}</span>
                            </mat-option>
                            <ng-container *ngIf="autoCompleteContainer[element].length > 0">
                              <mat-option *ngFor="let address of autoCompleteContainer[element]"
                                [value]="address.addressHumanReadable">
                                <span>{{ address.addressHumanReadable }}</span>
                              </mat-option>
                            </ng-container>
                          </ng-container>
                        </mat-autocomplete>
                      </div>
                    </div>
                    <div class="helper-wrapper">
                      <ng-container *ngIf="data_elements[element].helpertext">
                        <span class="tooltip" matTooltip="{{ selectLanguage(data_elements[element].helpertext) }}"
                          matTooltipPosition="above">
                        </span>
                      </ng-container> <!-- /HELPERTEXT QUESTIONMARK (?) -->
                    </div>
                  </div>
                </ng-container> <!-- /ADDRESS -->

                <ng-container
                  *ngIf="data_elements[element].type == 'date' && !isFieldDisabled(data_elements[element].readonly)">
                  <div class="squared-input__outer-wrapper date-wrapper">
                    <div class="squared-input__wrapper"
                      [class.complete]="data_elements[element].value || opened_step != this.max_step">
                      <span class="squared-input__title">
                        {{selectLanguage(data_elements[element].title)}}{{ data_elements[element].required ? '*' : ''}}
                      </span>
                      <div class="squared-input__field-wrapper">
                        <input class="squared-input__field" matInput [matDatepicker]="picker"
                          [placeholder]="selectLanguage(data_elements[element].title)"
                          [value]="getDatepickerValue(element)" readonly="true"
                          [(ngModel)]="data_elements[element].value" name="{{element}}"
                          (dateInput)="setDatepickerValue($event, element)"
                          (dateChange)="setDatepickerValue($event, element)" (focus)="datepickerFocus = true"
                          (blur)="datepickerFocus = false; setDatepickerValue($event, element)">
                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-datepicker #picker></mat-datepicker>
                      </div>
                    </div>
                    <div class="helper-wrapper">
                      <ng-container *ngIf="data_elements[element].helpertext">
                        <span class="tooltip" matTooltip="{{ selectLanguage(data_elements[element].helpertext) }}"
                          matTooltipPosition="above">
                        </span>
                      </ng-container> <!-- /HELPERTEXT QUESTIONMARK (?) -->
                    </div>
                  </div>
                </ng-container> <!-- /DATE -->

                <ng-container
                  *ngIf="data_elements[element].type == 'date' && isFieldDisabled(data_elements[element].readonly)">
                  <div class="squared-input__outer-wrapper">
                    <div class="squared-input__wrapper"
                      [class.complete]="data_elements[element].value || opened_step != this.max_step">
                      <span class="squared-input__title">
                        {{ selectLanguage(data_elements[element].title)}}{{data_elements[element].required ? '*': ''}}
                      </span>
                      <div class="squared-input__field-wrapper">
                        <input class="squared-input__field" type="text"
                          placeholder="{{selectLanguage(data_elements[element].title)}}{{data_elements[element].required ? '*': ''}}"
                          [attr.disabled]="isFieldDisabled(data_elements[element].readonly) ? '' : null"
                          [(ngModel)]="data_elements[element].value" name="{{element}}" />
                      </div>
                    </div>
                    <div class="helper-wrapper">
                      <ng-container *ngIf="data_elements[element].helpertext">
                        <span class="tooltip" matTooltip="{{ selectLanguage(data_elements[element].helpertext) }}"
                          matTooltipPosition="above">
                        </span>
                      </ng-container> <!-- /HELPERTEXT QUESTIONMARK (?) -->
                    </div>
                  </div>
                </ng-container><!-- /DATE -->

                <ng-container *ngIf="data_elements[element].type == 'file'">

                  <div class="squared-input__outer-wrapper dropzone-wrapper">
                    <span class="xjson__file__heading">
                      {{selectLanguage(data_elements[element].title) }}{{data_elements[element].required ? '*': ''}}
                    </span>
                    <div class="helper-wrapper">
                      <ng-container *ngIf="data_elements[element].helpertext">
                        <span class="tooltip" tooltipClass="AAAAAAAAAAA"
                          matTooltip="{{ selectLanguage(data_elements[element].helpertext) }}"
                          matTooltipPosition="above">
                        </span>
                      </ng-container> <!-- /HELPERTEXT QUESTIONMARK (?) -->
                    </div>
                  </div>

                  <div class="loaded-files-list">
                    <ng-container *ngIf="data_elements[element].value">
                      <ng-container *ngFor="let file of data_elements[element].value">
                        <div class="uploaded-file">
                          <a class="file-icon" [href]="fileDownloadlink(file)" target="_blank">
                            <span class="file-name">{{ file.file_name }}</span>
                          </a>
                          <a class="close-icn" href="javascript:void(0)"
                            *ngIf="!isFieldDisabled(data_elements[element].readonly)"
                            [class.disabled]="isFieldDisabled(data_elements[element].readonly)"
                            (click)="fileDelete(file.file_identifier, data_elements[element])"><span
                              class="htm-icon">close</span>{{ 'xjson.delete_file' | translate }}</a>
                        </div>
                      </ng-container>
                    </ng-container>
                  </div>

                  <loader *ngIf="fileLoading[element]"></loader>
                  <div class="dropzone" (drop)="fileEventHandler($event, element)" (dragover)="$event.preventDefault()"
                    *ngIf="canUploadFile(data_elements[element]) && !fileLoading[element]">
                    <div class="dropzone-text">
                      <span class="dropzone-title">
                        {{ 'xjson.drag_files_here_or' | translate }}
                      </span>
                      <a class="dropzone-add" href="javascript:void(0)">
                        <input type="file" [attr.disabled]="canUploadFile(data_elements[element]) ? null : ''"
                          (change)="fileEventHandler($event, element)"
                          placeholder="{{selectLanguage(data_elements[element].title)}}{{data_elements[element].required ? '*': ''}}"
                          [accept]="parseAcceptableExtentsions(data_elements[element].acceptable_extensions)"
                          [attr.multiple]="data_elements[element].multiple ? '' : null" />
                        {{ 'button.upload' | translate }}
                      </a>
                      <span class="dropzone-description">{{ 'xjson.allowed_filetypes' | translate }}
                        {{ displayAcceptableExtentsions(data_elements[element].acceptable_extensions) }}
                        <br>{{ 'xjson.max_size' | translate }} {{ data_elements[element].max_size }}MB</span>
                    </div>
                  </div>
                </ng-container> <!-- /FILE -->

                <ng-container *ngIf="error[element] && error[element].row == undefined">
                  <div class="error">
                    {{ error[element].message }}
                  </div>
                </ng-container> <!-- FIELD VALIDATION ERROR MESSAGE -->

              </div>
              <!--/col-12-->
            </div> <!-- row -->
          </ng-container>
        </form>

        <hr class="divider">

        <div [class]="navigationLinks.length > 0 ? 'row button-list separate' : 'row button-list'">

          <div *ngIf="navigationLinks.length > 0" class="secondary-buttons">
            <ng-container *ngFor="let link of navigationLinks">
              <a *ngIf="link.type === 'link'" href="javascript:void(0);"
                (click)="selectStep(link.step)">{{ link.label | translate }}</a>
              <button *ngIf="link.type === 'button'" type="submit" role="button" mat-raised-button [color]="['primary']"
                (click)="selectStep(link.step)">{{ link.label | translate }}</button>
            </ng-container>
          </div>

          <div class="primary-buttons">
            <button type="submit" role="button" mat-raised-button [color]="['alternative']"
              (click)="returnToPreviousUrl()">
              {{ 'button.cancel' | translate }}
            </button>
            <ng-container *ngFor="let activity of activityButtons['primary']">
              <button *ngIf="activity.action != 'EDIT'" type="submit" role="button" mat-raised-button
                [color]="[activity.style]" (click)="submitForm(activity.action)">
                {{ activity.label | translate }}
              </button>
            </ng-container>
          </div>

          <ng-container *ngFor="let activity of activityButtons['secondary']">
            <div class="subrow" *ngIf="activityButtons['secondary'].length">
              <a href="javascript:void(0);" (click)="submitForm(activity.action)">{{ activity.label | translate }}</a>
            </div> <!-- /row button-list -->
          </ng-container>
        </div> <!-- /row button-list -->
      </ng-container> <!-- /if !empty_data-->
    </ng-container> <!-- /if data-->
    <ng-container *ngIf="data && view == 'related_documents'">
      <div class="xjson__title">{{ 'frontpage.dashboard_related_documents' | translate }}</div>
      <p class="xjson__introduction" *ngIf="data.body.introduction">{{ selectLanguage(data.body.introduction) }}</p>

      <ng-container *ngIf="acceptable_forms.length">
        <div class="grid-box">
          <ng-container *ngFor="let form of acceptable_forms">
            <a [href]="form.link" class="grid-item">
              <span class="grid-link">{{ form.form_name }}</span>
            </a>
          </ng-container>
        </div>

        <ng-container
          *ngIf="data.header.acceptable_forms.length > acceptable_forms_limit && acceptable_forms_list_restricted == true">
          <div class="grid-load">
            <a href="javascript:void(0);" (click)="toggleAcceptableFormList()">+
              {{ 'button.show_more' | translate }}
              ({{ data.header.acceptable_forms.length - acceptable_forms_limit }})</a>
          </div>
        </ng-container>
        <ng-container *ngIf="acceptable_forms_list_restricted == false">
          <div class="grid-load">
            <a href="javascript:void(0);" (click)="toggleAcceptableFormList()">-
              {{ 'button.show_less' | translate }}</a>
          </div>
        </ng-container>


      </ng-container>
    </ng-container>
  </div>
  <!--/block border-blue-->
</div>
<!--/main-container-->