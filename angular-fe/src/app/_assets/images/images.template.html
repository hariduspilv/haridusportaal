<htm-swiper
  [config]="config"
  *ngIf="images?.length && config"
  [class.swiper-single-item]="images?.length === 1"
>
  <a href="javascript:void(0)" attr.aria-label="{{ 'gallery.link-title' | translate }}"
    *ngIf="images.length > 1 && firstImageLoaded" class="expand-gallery" (click)="openGallery()">
    {{ 'gallery.link-title' | translate }} ({{ images.length }})
  </a>
  <div
    class="swiper-wrapper"
    aria-roledescription="carousel"
    aria-live="polite"
  >
    <ng-container *ngFor="let image of images; let i = index; let l = count">
      <div class="swiper-slide slides__instance"
        role="group"
        aria-roledescription="slide"
        [attr.aria-label]="'slide ' + (i + 1) + ' of ' + l"
      >
        <img
          *ngIf="!image.videoId"
          [src]="image.derivative?.url"
          [title]="image.title"
          [alt]="image.alt"
          (load)="coverImageLoaded()"
        />
        <htm-video
          *ngIf="image.videoId"
          [videos]="image"
          (onLoad)="coverImageLoaded()"
        ></htm-video>
        <div
          class="image__title"
          *ngIf="image?.videoDescription || image?.title"
        >{{ image.videoDescription || image.title }}</div>
      </div>
    </ng-container>
  </div>
  <div class="swiper-pagination" aria-hidden="true" tabindex="-1"></div>
  <div class="slides__arrow slides__arrow--left" aria-hidden="true" tabindex="-1">
    <icon glyph="chevron-left" size="large" [bg]="true"></icon>
  </div>
  <div class="slides__arrow slides__arrow--right" aria-hidden="true" tabindex="-1">
    <icon glyph="chevron-right" size="large" [bg]="true"></icon>
  </div>
</htm-swiper>

<htm-modal [id]="_id" [bottomAction]="false" [blockModal]="false">
  <ng-template>
    <div class="gallery-container" attr.aria-label="{{ 'gallery.title' | translate }}">
      <div class="navigation-prev flex">
        <button attr.aria-label="{{ 'gallery.prev' | translate }}" htm-button theme="icon" (click)="handlePrev(activeImage)">
          <icon glyph="chevron-left" size="large" [bg]="true"></icon>
        </button>
      </div>
      <div class="gallery__items">
        <div class="gallery__items__index">
          {{ activeImage?.index + 1 }} / {{ images?.length }}
        </div>
        <div class="gallery__items__picture-container">
          <div class="gallery__items__active-image">
            <div class="navigation-prev flex">
              <button attr.aria-label="{{ 'gallery.prev' | translate }}" htm-button theme="icon" (click)="handlePrev(activeImage)">
                <icon glyph="chevron-left" size="small" [bg]="true"></icon>
              </button>
            </div>
            <ng-container *ngIf="!activeImage?.videoId">
              <div class="gallery__items__active-image__title" *ngIf="activeImage?.title">{{ activeImage?.title }}</div>
              <img [src]="activeImage?.derivative?.url" [title]="activeImage?.title ? activeImage.title : ''" [alt]="activeImage?.alt" />
            </ng-container>
            <htm-video *ngIf="activeImage?.videoId" [videos]="activeImage" [responsive]="true"></htm-video>
            <div class="navigation-next flex">
              <button attr.aria-label="{{ 'gallery.next' | translate }}" htm-button theme="icon" (click)="handleNext(activeImage)">
                <icon glyph="chevron-right" size="small" [bg]="true"></icon>
              </button>
            </div>
          </div>
          <div class="gallery__items__navigation">
            <ng-container *ngFor="let image of images">
              <a href="javascript:void(0)" (keyup)="handlePreviewEnter($event, image)"
                attr.aria-current="{{ (!image.videoId && activeImage.derivative?.url === image.derivative?.url)
                  || (image.videoId && activeImage.input === image.input) ? true : false }}">
                <img *ngIf="!image.videoId"
                  class="{{ activeImage.derivative?.url === image.derivative?.url ? 'active' : '' }}" [src]="image.derivative?.url"
                  [alt]="image.alt" [title]="image.title || ''" (click)="activeImage = image" />
                <img *ngIf="image.videoId"
                  class="{{ activeImage.input === image.input ? 'active' : '' }}" [src]="image.videoThumbnail"
                  [alt]="image.videoDescription || ''" [title]="image.title || ''" (click)="activeImage = image"/>
              </a>
            </ng-container>
          </div>
        </div>
      </div>
      <div class="navigation-next flex">
        <button attr.aria-label="{{ 'gallery.next' | translate }}" htm-button theme="icon" (click)="handleNext(activeImage)">
          <icon glyph="chevron-right" size="large" [bg]="true"></icon>
        </button>
      </div>
    </div>
  </ng-template>
</htm-modal>
